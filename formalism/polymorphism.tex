\input{symbols/polymorphism}

\subsection{Extension: polymorphism}

\subsubsection{Syntax}
\[\begin{array}{rrcl}
  \TMName  & \TMV  & \Coloneqq & \cdots \mid \TForall{\TVarMV}{\TMV} \mid \TVarMV \\
  \MTMName & \MTMV & \Coloneqq & \cdots
                     % \MTUnknown \mid \MTNum \mid \MTBool
                     % \mid \MTArrow{\MTMV}{\MTMV} \mid \MTProd{\MTMV}{\MTMV}
                     \mid \MTForall{\MTVarMV}{\MTMV} \mid \MTVarMV \mid \MTUnbound{\MTVarMV} \\
  \EMName  & \EMV  & \Coloneqq & \cdots \mid \ETypeLam{\TVarMV}{\EMV} \mid \ETypeAp{\EMV}{\TMV} \\
  \ECMName & \ECMV & \Coloneqq & \cdots \mid \ECTypeLam{\TVarMV}{\ECMV} \mid \ECTypeAp{\ECMV}{\MTMV}
\end{array}\]

\subsubsection{Unmarked types}
\judgbox{\ensuremath{\tvarCtxWFU{\tvarCtx}{\TMV}}} $\TMV$ is well-formed
%
\begin{mathpar}
  \inferrule[TWFUnknown]{ }{
    \tvarCtxWFU{\tvarCtx}{\MTUnknown}
  }

  \inferrule[TWFNum]{ }{
    \tvarCtxWFU{\tvarCtx}{\MTNum}
  }

  \inferrule[TWFBool]{ }{
    \tvarCtxWFU{\tvarCtx}{\MTBool}
  }

  \inferrule[TWFArr]{
    \tvarCtxWFU{\tvarCtx}{\MTMV_1} \\
    \tvarCtxWFU{\tvarCtx}{\MTMV_2}
  }{
    \tvarCtxWFU{\tvarCtx}{\TArrow{\MTMV_1}{\MTMV_2}}
  }

  \inferrule[TWFProd]{
    \tvarCtxWFU{\tvarCtx}{\MTMV_1} \\
    \tvarCtxWFU{\tvarCtx}{\MTMV_2}
  }{
    \tvarCtxWFU{\tvarCtx}{\TProd{\MTMV_1}{\MTMV_2}}
  }

  \inferrule[TWFForall]{
    \tvarCtxWFU{\extendTvarCtx{\tvarCtx}{\MTVarMV}}{\MTMV}
  }{
    \tvarCtxWFU{\tvarCtx}{\MTForall{\MTVarMV}{\MTMV}}
  }

  \inferrule[TWFVar]{
    \inTvarCtx{\tvarCtx}{\MTVarMV}
  }{
    \tvarCtxWFU{\tvarCtx}{\MTVarMV}
  }
\end{mathpar}

\judgbox{\ensuremath{\tvarCtxConsistentU{\tvarCtx}{\TMV_1}{\TMV_2}}} $\TMV_1$ and $\TMV_2$ are consistent
%
\begin{mathpar}
  \cdots

  \inferrule[TCForall]{
    \tvarCtxConsistentU{\extendTvarCtx{\tvarCtx}{\TVarMV}}{\TMV}{\TMV'}
  }{
    \tvarCtxConsistentU{\tvarCtx}{\TForall{\TVarMV}{\TMV}}{\TForall{\TVarMV}{\TMV'}}
  }

  \inferrule[TCVar]{
    \inTvarCtx{\tvarCtx}{\TVarMV}
  }{
    \tvarCtxConsistentU{\tvarCtx}{\TVarMV}{\TVarMV}
  }
\end{mathpar}

\subsubsection{Marked types}
\judgbox{\ensuremath{\tvarCtxWFM{\tvarCtx}{\MTMV}}} $\MTMV$ is well-formed
%
\begin{mathpar}
  \inferrule[MTWFUnknown]{ }{
    \tvarCtxWFM{\tvarCtx}{\TUnknown}
  }

  \inferrule[MTWFNum]{ }{
    \tvarCtxWFM{\tvarCtx}{\TNum}
  }

  \inferrule[MTWFBool]{ }{
    \tvarCtxWFM{\tvarCtx}{\TBool}
  }

  \inferrule[MTWFArr]{
    \tvarCtxWFM{\tvarCtx}{\MTMV_1} \\
    \tvarCtxWFM{\tvarCtx}{\MTMV_2}
  }{
    \tvarCtxWFM{\tvarCtx}{\TArrow{\MTMV_1}{\MTMV_2}}
  }

  \inferrule[MTWFProd]{
    \tvarCtxWFM{\tvarCtx}{\MTMV_1} \\
    \tvarCtxWFM{\tvarCtx}{\MTMV_2}
  }{
    \tvarCtxWFM{\tvarCtx}{\TProd{\MTMV_1}{\MTMV_2}}
  }

  \inferrule[MTWFForall]{
    \tvarCtxWFM{\extendTvarCtx{\tvarCtx}{\MTVarMV}}{\MTMV}
  }{
    \tvarCtxWFM{\tvarCtx}{\TForall{\MTVarMV}{\MTMV}}
  }

  \inferrule[MTWFVar]{
    \inTvarCtx{\tvarCtx}{\MTVarMV}
  }{
    \tvarCtxWFM{\tvarCtx}{\MTVarMV}
  }

  \inferrule[MTWFUnbound]{
    \notInTvarCtx{\tvarCtx}{\MTVarMV}
  }{
    \tvarCtxWFM{\tvarCtx}{\MTUnbound{\MTVarMV}}
  }
\end{mathpar}

\judgbox{\ensuremath{\tvarCtxConsistentM{\tvarCtx}{\MTMV_1}{\MTMV_2}}} $\MTMV_1$ and $\MTMV_2$ are consistent
%
\begin{mathpar}
  \cdots

  \inferrule[MTCForall]{
    \tvarCtxConsistentM{\extendTvarCtx{\tvarCtx}{\MTVarMV}}{\MTMV}{\MTMV'}
  }{
    \tvarCtxConsistentM{\tvarCtx}{\TForall{\MTVarMV}{\MTMV}}{\TForall{\MTVarMV}{\MTMV'}}
  }

  \inferrule[MTCVar]{
    \inTvarCtx{\tvarCtx}{\MTVarMV}
  }{
    \tvarCtxConsistentM{\tvarCtx}{\MTVarMV}{\MTVarMV}
  }

  \inferrule[MTCUnbound1]{
    \notInTvarCtx{\tvarCtx}{\MTVarMV}
  }{
    \tvarCtxConsistentM{\tvarCtx}{\MTUnbound{\MTVarMV}}{\MTMV}
  }

  \inferrule[MTCUnbound2]{
    \notInTvarCtx{\tvarCtx}{\MTVarMV}
  }{
    \tvarCtxConsistentM{\tvarCtx}{\MTMV}{\MTUnbound{\MTVarMV}}
  }
\end{mathpar}

\subsubsection{Unmarked expressions}
\judgbox{\ensuremath{\bothCtxSynTypeU{\tvarCtx}{\ctx}{\EMV}{\TMV}}} $\EMV$ synthesizes type $\TMV$
%
\begin{mathpar}
  \cdots

  \inferrule[USTypeLam]{
    \bothCtxSynTypeU{\extendTvarCtx{\tvarCtx}{\TVarMV}}{\ctx}{\EMV}{\TMV}
  }{
    \bothCtxSynTypeU{\tvarCtx}{\ctx}{\ETypeLam{\TVarMV}{\EMV}}{\TForall{\TVarMV}{\TMV}}
  }

  \inferrule[USTypeAp]{
    \bothCtxSynTypeU{\tvarCtx}{\ctx}{\EMV}{\TMV} \\
    \tvarCtxWFU{\tvarCtx}{\TMV_2} \\
    \matchedForall{\TMV}{\TVarMV}{\TMV_1}
  }{
    \bothCtxSynTypeU{\tvarCtx}{\ctx}{\ETypeAp{\EMV}{\TMV_2}}{\subst{\TMV_1}{\TMV_2}{\TVarMV}}
  }
\end{mathpar}

\judgbox{\ensuremath{\bothCtxAnaTypeU{\tvarCtx}{\ctx}{\EMV}{\TMV}}} $\EMV$ analyzes against type $\TMV$
%
\begin{mathpar}
  \cdots

  \inferrule[UATypeLam]{
    \matchedForall{\TMV}{\TVarMV}{\TMV'} \\
    \bothCtxAnaTypeU{\extendTvarCtx{\tvarCtx}{\TVarMV}}{\ctx}{\EMV}{\TMV'}
  }{
    \bothCtxAnaTypeU{\tvarCtx}{\ctx}{\ETypeLam{\TVarMV}{\EMV}}{\TMV}
  }
\end{mathpar}

\judgbox{\ensuremath{\subsumable{\EMV}}} $\EMV$ is subsumable
%
\begin{mathpar}
  \cdots

  \inferrule[USuTypeAp]{ }{
    \subsumable{\ETypeAp{\EMV}{\TMV}}
  }
\end{mathpar}
