\input{symbols/polymorphism}

\subsection{Extension: polymorphism}

\subsubsection{Syntax}
\[\begin{array}{rrcl}
  \TMName  & \TMV  & \Coloneqq & \cdots \mid \TForall{\TVarMV}{\TMV} \mid \TVarMV \\
  \MTMName & \MTMV & \Coloneqq & \MTUnknown \mid \MTNum \mid \MTBool
                     \mid \MTArrow{\MTMV}{\MTMV} \mid \MTProd{\MTMV}{\MTMV}
                     \mid \MTForall{\MTVarMV}{\MTMV} \mid \MTVarMV \mid \MTUnbound{\MTVarMV} \\
  \EMName  & \EMV  & \Coloneqq & \cdots \mid \ETypeLam{\TVarMV}{\EMV} \mid \ETypeAp{\EMV}{\TMV} \\
  \ECMName & \ECMV & \Coloneqq & \cdots \mid \ECTypeLam{\TVarMV}{\ECMV} \mid \ECTypeAp{\ECMV}{\MTMV}
\end{array}\]

\subsubsection{Unmarked types}
\judgbox{\ensuremath{\tvarCtxWFU{\tvarCtx}{\TMV}}} $\TMV$ is well-formed
%
\begin{mathpar}
  \inferrule[TWFUnknown]{ }{
    \tvarCtxWFU{\tvarCtx}{\TUnknown}
  }

  \inferrule[TWFNum]{ }{
    \tvarCtxWFU{\tvarCtx}{\TNum}
  }

  \inferrule[TWFBool]{ }{
    \tvarCtxWFU{\tvarCtx}{\TBool}
  }

  \inferrule[TWFArr]{
    \tvarCtxWFU{\tvarCtx}{\TMV_1} \\
    \tvarCtxWFU{\tvarCtx}{\TMV_2}
  }{
    \tvarCtxWFU{\tvarCtx}{\TArrow{\TMV_1}{\TMV_2}}
  }

  \inferrule[TWFProd]{
    \tvarCtxWFU{\tvarCtx}{\TMV_1} \\
    \tvarCtxWFU{\tvarCtx}{\TMV_2}
  }{
    \tvarCtxWFU{\tvarCtx}{\TProd{\TMV_1}{\TMV_2}}
  }

  \inferrule[TWFVar]{
    \inTvarCtx{\tvarCtx}{\TVarMV}
  }{
    \tvarCtxWFU{\tvarCtx}{\TVarMV}
  }

  \inferrule[TWFForall]{
    \tvarCtxWFU{\extendTvarCtx{\tvarCtx}{\TVarMV}}{\TMV}
  }{
    \tvarCtxWFU{\tvarCtx}{\TForall{\TVarMV}{\TMV}}
  }
\end{mathpar}

\judgbox{\ensuremath{\tvarCtxConsistentU{\tvarCtx}{\TMV_1}{\TMV_2}}} $\TMV_1$ and $\TMV_2$ are consistent
%
\begin{mathpar}
  \cdots

  \inferrule[TCVar]{
    \inTvarCtx{\tvarCtx}{\TVarMV}
  }{
    \tvarCtxConsistentU{\tvarCtx}{\TVarMV}{\TVarMV}
  }

  \inferrule[TCForall]{
    \tvarCtxConsistentU{\extendTvarCtx{\tvarCtx}{\TVarMV}}{\TMV}{\TMV'}
  }{
    \tvarCtxConsistentU{\tvarCtx}{\TForall{\TVarMV}{\TMV}}{\TForall{\TVarMV}{\TMV'}}
  }
\end{mathpar}

\subsubsection{Unmarked expressions}
\judgbox{\ensuremath{\bothCtxSynTypeU{\tvarCtx}{\ctx}{\EMV}{\TMV}}} $\EMV$ synthesizes type $\TMV$
%
\begin{mathpar}
  \cdots

  \inferrule[USTypeLam]{
    \bothCtxSynTypeU{\extendTvarCtx{\tvarCtx}{\TVarMV}}{\ctx}{\EMV}{\TMV}
  }{
    \bothCtxSynTypeU{\tvarCtx}{\ctx}{\ETypeLam{\TVarMV}{\EMV}}{\TForall{\TVarMV}{\TMV}}
  }

  \inferrule[USTypeAp]{
    \bothCtxSynTypeU{\tvarCtx}{\ctx}{\EMV}{\TMV} \\
    \tvarCtxWFU{\tvarCtx}{\TMV_2} \\
    \matchedForall{\TMV}{\TVarMV}{\TMV_1}
  }{
    \bothCtxSynTypeU{\tvarCtx}{\ctx}{\ETypeAp{\EMV}{\TMV_2}}{\subst{\TMV_1}{\TMV_2}{\TVarMV}}
  }
\end{mathpar}

\judgbox{\ensuremath{\bothCtxAnaTypeU{\tvarCtx}{\ctx}{\EMV}{\TMV}}} $\EMV$ analyzes against type $\TMV$
%
\begin{mathpar}
  \cdots

  \inferrule[UATypeLam]{
    \matchedForall{\TMV}{\TVarMV}{\TMV'} \\
    \bothCtxAnaTypeU{\extendTvarCtx{\tvarCtx}{\TVarMV}}{\ctx}{\EMV}{\TMV'}
  }{
    \bothCtxAnaTypeU{\tvarCtx}{\ctx}{\ETypeLam{\TVarMV}{\EMV}}{\TMV}
  }
\end{mathpar}

\judgbox{\ensuremath{\subsumable{\EMV}}} $\EMV$ is subsumable
%
\begin{mathpar}
  \cdots

  \inferrule[USuTypeAp]{ }{
    \subsumable{\ETypeAp{\EMV}{\TMV}}
  }
\end{mathpar}
