\documentclass{article}
\input{preamble/preamble}
\usepackage[margin=1in]{geometry}

\makeatletter
\renewcommand\tableofcontents{%
    \@starttoc{toc}%
}
\makeatother

\begin{document}
\tableofcontents

\renewcommand{\thesection}{\Alph{section}}
\section{Marked Lambda Calculus}
The \emph{marked lambda calculus} is a judgmental framework for bidirectional type error
localization and recovery. Below is the complete formalization of the calculus on a gradually typed
lambda calculus, with rules organized by judgment.

\subsection{Syntax}
\[\begin{array}{rrcl}
  \TMName  & \TMV  & \Coloneqq & \TUnknown \mid \TNum \mid \TBool \mid \TArrow{\TMV}{\TMV} \mid \TProd{\TMV}{\TMV} \\
  \EMName  & \EMV  & \Coloneqq & x \mid \ELam{x}{\TMV}{\EMV} \mid \EAp{\EMV}{\EMV} \mid \ELet{x}{\EMV}{\EMV}
                     \mid           \ENumMV \mid \EPlus{\EMV}{\EMV} \\
           &       & \mid         & \ETrue \mid \EFalse \mid \EIf{\EMV}{\EMV}{\EMV}
                     \mid           \EPair{\EMV}{\EMV}
                     \mid           \EProjL{\EMV} \mid \EProjR{\EMV}
                     \mid           \EEHole \\
  \ECMName & \ECMV & \Coloneqq & x \mid \ECLam{x}{\TMV}{\ECMV} \mid \ECAp{\ECMV}{\ECMV} \mid \ECLet{x}{\ECMV}{\ECMV}
                     \mid           \ECNumMV \mid \ECPlus{\ECMV}{\ECMV} \\
           &       & \mid         & \ECTrue \mid \ECFalse \mid \ECIf{\ECMV}{\ECMV}{\ECMV}
                     \mid           \ECPair{\ECMV}{\ECMV} \mid \ECProjL{\ECMV} \mid \ECProjR{\ECMV}
                     \mid           \ECEHole \\
           &       & \mid         & \ECUnbound{x} \mid \ECInconType{\ECMV} \mid \ECInconBr{\ECMV}{\ECMV}{\ECMV} \mid \ECInconAsc{\ECMV} \\
           &       & \mid         & \ECSynNonMatchedArrow{\ECMV} \mid \ECAnaNonMatchedArrow{\ECMV}
                     \mid           \ECSynNonMatchedProd{\ECMV} \mid \ECAnaNonMatchedProd{\ECMV}
\end{array}\]

\subsection{Types}
\judgbox{\ensuremath{\consistent{\TMV_1}{\TMV_2}}} $\TMV_1$ is consistent with $\TMV_2$
%
\begin{mathpar}
  \judgment{ }{
    \consistent{\TUnknown}{\TMV}
  }{TCUnknown1}

  \judgment{ }{
    \consistent{\TMV}{\TUnknown}
  }{TCUnknown2}

  \judgment{ }{
    \consistent{\TMV}{\TMV}
  }{TCRefl}

  \judgment{
    \consistent{\TMV_1}{\TMV_1'} \\
    \consistent{\TMV_2}{\TMV_2'} \\
  }{
    \consistent{\TArrow{\TMV_1}{\TMV_2}}{\TArrow{\TMV_1'}{\TMV_2'}}
  }{TCArr}

  \judgment{
    \consistent{\TMV_1}{\TMV_1'} \\
    \consistent{\TMV_2}{\TMV_2'} \\
  }{
    \consistent{\TProd{\TMV_1}{\TMV_2}}{\TProd{\TMV_1'}{\TMV_2'}}
  }{TCProd}
\end{mathpar} \\

\judgbox{\ensuremath{\matchedArrow{\TMV}{\TMV_1}{\TMV_2}}} $\TMV$ has matched arrow type $\TArrow{\TMV_1}{\TMV_2}$
%
\begin{mathpar}
  \judgment{ }{
    \matchedArrow{\TUnknown}{\TUnknown}{\TUnknown}
  }{TMAUnknown}

  \judgment{ }{
    \matchedArrow{\TArrow{\TMV_1}{\TMV_2}}{\TMV_1}{\TMV_2}
  }{TMAArr}
\end{mathpar} \\

\judgbox{\ensuremath{\matchedProd{\TMV}{\TMV_1}{\TMV_2}}} $\TMV$ has matched binary product type $\TProd{\TMV_1}{\TMV_2}$
%
\begin{mathpar}
  \judgment{ }{
    \matchedProd{\TUnknown}{\TUnknown}{\TUnknown}
  }{TMPUnknown}

  \judgment{ }{
    \matchedProd{\TProd{\TMV_1}{\TMV_2}}{\TMV_1}{\TMV_2}
  }{TMPProd}
\end{mathpar} \\

\judgbox{\ensuremath{\TJoin{\TMV_1}{\TMV_2}}} is a \emph{partial} metafunction defined as follows:
%
\newcommand{\joinsTo}[3]{\ensuremath{\TJoin{#1}{#2} & = & #3}}
\[\begin{array}{rcl}
  \joinsTo{\TUnknown}{\TMV}{\TMV} \\
  \joinsTo{\TMV}{\TUnknown}{\TMV} \\
  \joinsTo{\TNum}{\TNum}{\TNum} \\
  \joinsTo{\TBool}{\TBool}{\TBool} \\
  \joinsTo{(\TArrow{\TMV_1}{\TMV_2})}{(\TArrow{\TMV_1'}{\TMV_2'})}{\TArrow{(\TJoin{\TMV_1}{\TMV_1'})}{(\TJoin{\TMV_2}{\TMV_2'})}} \\
  \joinsTo{(\TProd{\TMV_1}{\TMV_2})}{(\TProd{\TMV_1'}{\TMV_2'})}{\TProd{(\TJoin{\TMV_1}{\TMV_1'})}{(\TJoin{\TMV_2}{\TMV_2'})}}
\end{array}\] \\

\judgbox{\ensuremath{\base{\TMV}}} $\TMV$ is a base type
%
\begin{mathpar}
  \judgment{ }{
    \base{\TNum}
  }{TBNum}

  \judgment{ }{
    \base{\TBool}
  }{TBBool}
\end{mathpar}

\subsection{Unmarked Expressions}
\judgbox{\ctxSynTypeU{\ctx}{\EMV}{\TMV}} $\EMV$ synthesizes type $\TMV$
%
\begin{mathpar}
  \judgment{ }{
    \ctxSynTypeU{\ctx}{\EEHole}{\TUnknown}
  }{USHole}

  \judgment{
    \inCtx{\ctx}{x}{\TMV}
  }{
    \ctxSynTypeU{\ctx}{x}{\TMV}
  }{USVar}

  \judgment{
    \ctxSynTypeU{\extendCtx{\ctx}{x}{\TMV}}{\EMV}{\TMV_2}
  }{
    \ctxSynTypeU{\ctx}{\ELam{x}{\TMV_1}{\EMV}}{\TArrow{\TMV_1}{\TMV_2}}
  }{USLam}

  \judgment{
    \ctxSynTypeU{\ctx}{\EMV_1}{\TMV} \\
    \matchedArrow{\TMV}{\TMV_1}{\TMV_2} \\
    \ctxAnaTypeU{\ctx}{\EMV_2}{\TMV_1}
  }{
    \ctxSynTypeU{\ctx}{\EAp{\EMV_1}{\EMV_2}}{\TMV_2}
  }{USAp}

  \judgment{
    \ctxSynTypeU{\ctx}{\EMV_1}{\TMV_1} \\
    \ctxSynTypeU{\extendCtx{\ctx}{x}{\TMV_1}}{\EMV_2}{\TMV_2}
  }{
    \ctxSynTypeU{\ctx}{\ELet{x}{\EMV_1}{\EMV_2}}{\TMV_2}
  }{USLet}

  \judgment{ }{
    \ctxSynTypeU{\ctx}{\ENumMV}{\TNum}
  }{USNum}

  \judgment{
    \ctxAnaTypeU{\ctx}{\EMV_1}{\TNum} \\
    \ctxAnaTypeU{\ctx}{\EMV_2}{\TNum}
  }{
    \ctxSynTypeU{\ctx}{\EPlus{\EMV_1}{\EMV_2}}{\TNum}
  }{USPlus}

  \judgment{ }{
    \ctxSynTypeU{\ctx}{\ETrue}{\TBool}
  }{USTrue}

  \judgment{ }{
    \ctxSynTypeU{\ctx}{\EFalse}{\TBool}
  }{USFalse}

  \judgment{
    \ctxAnaTypeU{\ctx}{\EMV_1}{\TBool} \\
    \ctxSynTypeU{\ctx}{\EMV_2}{\TMV_1} \\
    \ctxSynTypeU{\ctx}{\EMV_3}{\TMV_2}
  }{
    \ctxSynTypeU{\ctx}{\EIf{\EMV_1}{\EMV_2}{\EMV_3}}{\TJoin{\TMV_1}{\TMV_2}}
  }{USIf}

  \judgment{
    \ctxSynTypeU{\ctx}{\EMV_1}{\TMV_1} \\
    \ctxSynTypeU{\ctx}{\EMV_2}{\TMV_2}
  }{
    \ctxSynTypeU{\ctx}{\EPair{\EMV_1}{\EMV_2}}{\TProd{\TMV_1}{\TMV_2}}
  }{USPair}

  \judgment{
    \ctxSynTypeU{\ctx}{\EMV}{\TMV} \\
    \matchedProd{\TMV}{\TMV_1}{\TMV_2}
  }{
    \ctxSynTypeU{\ctx}{\EProjL{\EMV}}{\TMV_1}
  }{USProjL}

  \judgment{
    \ctxSynTypeU{\ctx}{\EMV}{\TMV} \\
    \matchedProd{\TMV}{\TMV_1}{\TMV_2}
  }{
    \ctxSynTypeU{\ctx}{\EProjR{\EMV}}{\TMV_2}
  }{USProjR}
\end{mathpar} \\

\judgbox{\ctxAnaTypeU{\ctx}{\EMV}{\TMV}} $\EMV$ analyzes against type $\TMV$
%
\begin{mathpar}
  \judgment{
    \matchedArrow{\TMV_3}{\TMV_1}{\TMV_2} \\
    \consistent{\TMV}{\TMV_1} \\
    \ctxAnaTypeU{\extendCtx{\ctx}{x}{\TMV}}{\EMV}{\TMV_2}
  }{
    \ctxAnaTypeU{\ctx}{\ECLam{x}{\TMV}{\EMV}}{\TMV_3}
  }{UALam}

  \judgment{
    \ctxSynTypeU{\ctx}{\EMV_1}{\TMV_1} \\
    \ctxAnaTypeU{\extendCtx{\ctx}{x}{\TMV_1}}{\EMV_2}{\TMV_2}
  }{
    \ctxAnaTypeU{\ctx}{\ELet{x}{\EMV_1}{\EMV_2}}{\TMV_2}
  }{UALet}

  \judgment{
    \ctxAnaTypeU{\ctx}{\EMV_1}{\TBool} \\
    \ctxAnaTypeU{\ctx}{\EMV_1}{\TMV} \\
    \ctxAnaTypeU{\ctx}{\EMV_2}{\TMV}
  }{
    \ctxAnaTypeU{\ctx}{\ECIf{\EMV_1}{\EMV_2}{\EMV_3}}{\TMV}
  }{UAIf}

  \judgment{
    \matchedProd{\TMV}{\TMV_1}{\TMV_2} \\
    \ctxAnaTypeU{\ctx}{\EMV_1}{\TMV_1} \\
    \ctxAnaTypeU{\ctx}{\EMV_2}{\TMV_2}
  }{
    \ctxAnaTypeU{\ctx}{\EPair{\EMV_1}{\EMV_2}}{\TMV}
  }{UAPair}

  \judgment{
    \ctxSynTypeU{\ctx}{\EMV}{\TMV'} \\
    \consistent{\TMV}{\TMV'} \\
    \subsumable{\EMV}
  }{
    \ctxAnaTypeU{\ctx}{\EMV}{\TMV}
  }{UASubsume}
\end{mathpar} \\

\judgbox{\subsumable{\EMV}} $\EMV$ is subsumable
%
\begin{mathpar}
  \judgment{ }{
    \subsumable{\EEHole}
  }{USuHole}

  \judgment{ }{
    \subsumable{x}
  }{USuVar}

  \judgment{ }{
    \subsumable{\EAp{\EMV_1}{\EMV_2}}
  }{USuAp}

  \judgment{ }{
    \subsumable{\ENumMV}
  }{USuNum}

  \judgment{ }{
    \subsumable{\EPlus{\EMV_1}{\EMV_2}}
  }{USuPlus}

  \judgment{ }{
    \subsumable{\ETrue}
  }{USuTrue}

  \judgment{ }{
    \subsumable{\EFalse}
  }{USuFalse}

  \judgment{ }{
    \subsumable{\EProjL{\EMV}}
  }{USuProjL}

  \judgment{ }{
    \subsumable{\EProjR{\EMV}}
  }{USuProjR}
\end{mathpar}

\subsection{Marking}
\judgbox{\ctxSynFixedInto{\ctx}{\EMV}{\ECMV}{\TMV}} $\EMV$ is marked into $\ECMV$ and synthesizes type $\TMV$
%
\begin{mathpar}
  \judgment{ }{
    \ctxSynFixedInto{\ctx}{\EEHole}{\ECEHole}{\TUnknown}
  }{MKSHole}

  \judgment{
    \inCtx{\ctx}{x}{\TMV}
  }{
    \ctxSynFixedInto{\ctx}{x}{x}{\TMV}
  }{MKSVar}

  \judgment{
    \notInCtx{\ctx}{x}
  }{
    \ctxSynFixedInto{\ctx}{x}{\ECUnbound{x}}{\TUnknown}
  }{MKSUnbound}

  \judgment{
    \ctxSynFixedInto{\extendCtx{\ctx}{x}{\TMV_1}}{\EMV}{\ECMV}{\TMV_2}
  }{
    \ctxSynFixedInto{\ctx}{\ELam{x}{\TMV_1}{\EMV}}{\ELam{x}{\TMV_1}{\ECMV}}{\TArrow{\TMV_1}{\TMV_2}}
  }{MKSLam}

  \judgment{
    \ctxSynFixedInto{\ctx}{\EMV_1}{\ECMV_1}{\TMV} \\
    \matchedArrow{\TMV}{\TMV_1}{\TMV_2} \\
    \ctxAnaFixedInto{\ctx}{\EMV_2}{\ECMV_2}{\TMV_1} \\
  }{
    \ctxSynFixedInto{\ctx}{\EAp{\EMV_1}{\EMV_2}}{\ECAp{\ECMV_1}{\ECMV_2}}{\TMV_2}
  }{MKSAp1}

  % \judgment{
    % \ctxSynFixedInto{\ctx}{\EMV_1}{\ECMV_1}{\TMV} \\
    % \notMatchedArrow{\TMV} \\
    % \ctxAnaFixedInto{\ctx}{\EMV_2}{\ECMV_2}{\TUnknown}
  % }{
    % \ctxSynFixedInto{\ctx}{\EAp{\EMV_1}{\EMV_2}}{\ECApNonMatched{\ECMV_1}{\ECMV_2}}{\TUnknown}
  % }{MKSAp2}

  % \judgment{
    % \ctxSynFixedInto{\ctx}{\EMV_1}{\ECMV_1}{\TMV} \\
    % \notMatchedArrow{\TMV} \\
    % \ctxAnaFixedInto{\ctx}{\EMV_2}{\ECMV_2}{\TUnknown}
  % }{
    % \ctxSynFixedInto{\ctx}{\EAp{\EMV_1}{\EMV_2}}{\ECApNonMatchedAlt{\ECMV_1}{\ECMV_2}}{\TUnknown}
  % }{MKSAp2}

  \judgment{
    \ctxSynFixedInto{\ctx}{\EMV_1}{\ECMV_1}{\TMV} \\
    \notMatchedArrow{\TMV} \\
    \ctxAnaFixedInto{\ctx}{\EMV_2}{\ECMV_2}{\TUnknown}
  }{
    \ctxSynFixedInto{\ctx}{\EAp{\EMV_1}{\EMV_2}}{\ECApSynNonMatchedArrow{\ECMV_1}{\ECMV_2}}{\TUnknown}
  }{MKSAp2}

  \judgment{
    \ctxSynFixedInto{\ctx}{\EMV_1}{\ECMV_1}{\TMV_1} \\
    \ctxSynFixedInto{\extendCtx{\ctx}{x}{\TMV_1}}{\EMV_2}{\ECMV_2}{\TMV_2}
  }{
    \ctxSynFixedInto{\ctx}{\ECLet{x}{\EMV_1}{\EMV_2}}{\ECLet{x}{\ECMV_1}{\ECMV_2}}{\TMV_2}
  }{MKSLet}

  \judgment{
  }{
    \ctxSynFixedInto{\ctx}{\ENumMV}{\ECNumMV}{\TNum}
  }{MKSNum}

  \judgment{
    \ctxAnaFixedInto{\ctx}{\EMV_1}{\ECMV_1}{\TNum} \\
    \ctxAnaFixedInto{\ctx}{\EMV_2}{\ECMV_2}{\TNum}
  }{
    \ctxSynFixedInto{\ctx}{\EPlus{\EMV_1}{\EMV_2}}{\ECPlus{\ECMV_1}{\ECMV_2}}{\TNum}
  }{MKSPlus}

  \judgment{
  }{
    \ctxSynFixedInto{\ctx}{\ETrue}{\ECTrue}{\TBool}
  }{MKSTrue}

  \judgment{
  }{
    \ctxSynFixedInto{\ctx}{\EFalse}{\ECFalse}{\TBool}
  }{MKSFalse}

  \judgment{
    \ctxAnaFixedInto{\ctx}{\EMV_1}{\ECMV_1}{\TBool} \\
    \ctxSynFixedInto{\ctx}{\EMV_2}{\ECMV_2}{\TMV_1} \\
    \ctxSynFixedInto{\ctx}{\EMV_3}{\ECMV_3}{\TMV_2}
  }{
    \ctxSynFixedInto{\ctx}{\EIf{\EMV_1}{\EMV_2}{\EMV_3}}{\ECIf{\ECMV_1}{\ECMV_2}{\ECMV_3}}{\TJoin{\TMV_1}{\TMV_2}}
  }{MKSIf}

  \judgment{
    \ctxAnaFixedInto{\ctx}{\EMV_1}{\ECMV_1}{\TBool} \\
    \ctxSynFixedInto{\ctx}{\EMV_2}{\ECMV_2}{\TMV_1} \\
    \ctxSynFixedInto{\ctx}{\EMV_3}{\ECMV_3}{\TMV_2} \\
    \inconsistent{\TMV_1}{\TMV_2}
  }{
    \ctxSynFixedInto{\ctx}{\EIf{\EMV_1}{\EMV_2}{\EMV_3}}{\ECInconBr{\ECMV_1}{\ECMV_2}{\ECMV_3}}{\TUnknown}
  }{MKSInconsistentBranches}

  \judgment{
    \ctxSynFixedInto{\ctx}{\EMV_1}{\ECMV_1}{\TMV_1} \\
    \ctxSynFixedInto{\ctx}{\EMV_2}{\ECMV_2}{\TMV_2}
  }{
    \ctxSynFixedInto{\ctx}{\EPair{\EMV_1}{\EMV_2}}{\ECPair{\ECMV_1}{\ECMV_2}}{\TProd{\TMV_1}{\TMV_2}}
  }{MKSPair}

  \judgment{
    \ctxSynFixedInto{\ctx}{\EMV}{\ECMV}{\TMV} \\
    \matchedProd{\TMV}{\TMV_1}{\TMV_2}
  }{
    \ctxSynFixedInto{\ctx}{\EProjL{\EMV}}{\ECProjL{\ECMV}}{\TMV_1}
  }{MKSProjL1}

  \judgment{
    \ctxSynFixedInto{\ctx}{\EMV}{\ECMV}{\TMV} \\
    \notMatchedProd{\TMV}
  }{
    \ctxSynFixedInto{\ctx}{\EProjL{\EMV}}{\ECProjLSynNonMatchedProd{\ECMV}}{\TMV_1}
  }{MKSProjL2}

  \judgment{
    \ctxSynFixedInto{\ctx}{\EMV}{\ECMV}{\TMV} \\
    \matchedProd{\TMV}{\TMV_1}{\TMV_2}
  }{
    \ctxSynFixedInto{\ctx}{\EProjR{\EMV}}{\ECProjR{\ECMV}}{\TMV_2}
  }{MKSProjR1}

  \judgment{
    \ctxSynFixedInto{\ctx}{\EMV}{\ECMV}{\TMV} \\
    \notMatchedProd{\TMV}
  }{
    \ctxSynFixedInto{\ctx}{\EProjR{\EMV}}{\ECProjRSynNonMatchedProd{\ECMV}}{\TMV_2}
  }{MKSProjR2}
\end{mathpar} \\

\judgbox{\ctxAnaFixedInto{\ctx}{\EMV}{\ECMV}{\TMV}} $\EMV$ is marked into $\ECMV$ and analyzes against type $\TMV$
%
\begin{mathpar}
  \judgment{
    \matchedArrow{\TMV_3}{\TMV_1}{\TMV_2} \\
    \consistent{\TMV}{\TMV_1} \\
    \ctxAnaFixedInto{\extendCtx{\ctx}{x}{\TMV}}{\EMV}{\ECMV}{\TMV_2}
  }{
    \ctxAnaFixedInto{\ctx}{\ELam{x}{\TMV}{\EMV}}{\ECLam{x}{\TMV}{\ECMV}}{\TMV_3}
  }{MKALam1}

  \judgment{
    \notMatchedArrow{\TMV_3} \\
    \ctxAnaFixedInto{\extendCtx{\ctx}{x}{\TMV}}{\EMV}{\ECMV}{\TUnknown}
  }{
    \ctxAnaFixedInto{\ctx}{\ELam{x}{\TMV}{\EMV}}{\ECLamAnaNonMatchedArrow{x}{\TMV}{\ECMV}}{\TMV_3}
  }{MKALam2}

  \judgment{
    \matchedArrow{\TMV_3}{\TMV_1}{\TMV_2} \\
    \inconsistent{\TMV}{\TMV_1} \\
    \ctxAnaFixedInto{\extendCtx{\ctx}{x}{\TMV_1}}{\EMV}{\ECMV}{\TMV_2}
  }{
    \ctxAnaFixedInto{\ctx}{\ELam{x}{\TMV}{\EMV}}{\ECLamInconAsc{x}{\TMV}{\ECMV}}{\TMV_3}
  }{MKALam3}

  \judgment{
    \ctxSynFixedInto{\ctx}{\EMV_1}{\ECMV_1}{\TMV_1} \\
    \ctxAnaFixedInto{\extendCtx{\ctx}{x}{\TMV_1}}{\EMV_2}{\ECMV_2}{\TMV_2}
  }{
    \ctxAnaFixedInto{\ctx}{\ECLet{x}{\EMV_1}{\EMV_2}}{\ECLet{x}{\ECMV_1}{\ECMV_2}}{\TMV_2}
  }{MKALet}

  \judgment{
    \ctxAnaFixedInto{\ctx}{\EMV_1}{\ECMV_1}{\TBool} \\
    \ctxAnaFixedInto{\ctx}{\EMV_2}{\ECMV_2}{\TMV} \\
    \ctxAnaFixedInto{\ctx}{\EMV_3}{\ECMV_3}{\TMV} \\
  }{
    \ctxAnaFixedInto{\ctx}{\EIf{\EMV_1}{\EMV_2}{\EMV_3}}{\ECIf{\ECMV_1}{\ECMV_2}{\ECMV_3}}{\TMV}
  }{MKAIf}

  \judgment{
    \matchedProd{\TMV}{\TMV_1}{\TMV_2} \\
    \ctxAnaFixedInto{\ctx}{\EMV_1}{\ECMV_1}{\TMV_1} \\
    \ctxAnaFixedInto{\ctx}{\EMV_2}{\ECMV_2}{\TMV_2}
  }{
    \ctxAnaFixedInto{\ctx}{\EPair{\EMV_1}{\EMV_2}}{\ECPair{\ECMV_1}{\ECMV_2}}{\TMV}
  }{MKAPair1}

  \judgment{
    \notMatchedProd{\TMV} \\
    \ctxAnaFixedInto{\ctx}{\EMV_1}{\ECMV_1}{\TUnknown} \\
    \ctxAnaFixedInto{\ctx}{\EMV_2}{\ECMV_2}{\TUnknown}
  }{
    \ctxAnaFixedInto{\ctx}{\EPair{\EMV_1}{\EMV_2}}{\ECPairAnaNonMatchedProd{\ECMV_1}{\ECMV_2}}{\TMV}
  }{MKAPair2}

  \judgment{
    \ctxSynFixedInto{\ctx}{\EMV}{\ECMV}{\TMV'} \\
    \inconsistent{\TMV}{\TMV'} \\
    \subsumable{\EMV}
  }{
    \ctxAnaFixedInto{\ctx}{\EMV}{\ECInconType{\ECMV}}{\TMV}
  }{MKAInconsistentTypes}

  \judgment{
    \ctxSynFixedInto{\ctx}{\EMV}{\ECMV}{\TMV'} \\
    \consistent{\TMV}{\TMV'} \\
    \subsumable{\EMV}
  }{
    \ctxAnaFixedInto{\ctx}{\EMV}{\ECMV}{\TMV}
  }{MKASubsume}
\end{mathpar}

\subsection{Marked Expressions}
\judgbox{\ctxSynTypeM{\ctx}{\ECMV}{\TMV}} $\ECMV$ synthesizes type $\TMV$
%
\begin{mathpar}
  \judgment{ }{
    \ctxSynTypeM{\ctx}{\ECEHole}{\TUnknown}
  }{MSHole}

  \judgment{
    \inCtx{\ctx}{x}{\TMV}
  }{
    \ctxSynTypeM{\ctx}{x}{\TMV}
  }{MSVar}

  \judgment{
    \notInCtx{\ctx}{x}
  }{
    \ctxSynTypeM{\ctx}{\ECUnbound{x}}{\TUnknown}
  }{MSUnbound}

  \judgment{
    \ctxSynTypeM{\extendCtx{\ctx}{x}{\TMV}}{\ECMV}{\TMV_2}
  }{
    \ctxSynTypeM{\ctx}{\ECLam{x}{\TMV_1}{\ECMV}}{\TArrow{\TMV_1}{\TMV_2}}
  }{MSLam}

  \judgment{
    \ctxSynTypeM{\ctx}{\ECMV_1}{\TMV} \\
    \matchedArrow{\TMV}{\TMV_1}{\TMV_2} \\
    \ctxAnaTypeM{\ctx}{\ECMV_2}{\TMV_1}
  }{
    \ctxSynTypeM{\ctx}{\ECAp{\ECMV_1}{\ECMV_2}}{\TMV_2}
  }{MSAp1}

  % \judgment{
    % \ctxSynTypeM{\ctx}{\ECMV_1}{\TMV} \\
    % \notMatchedArrow{\TMV} \\
    % \ctxAnaTypeM{\ctx}{\ECMV_2}{\TUnknown}
  % }{
    % \ctxSynTypeM{\ctx}{\ECApNonMatched{\ECMV_1}{\ECMV_2}}{\TUnknown}
  % }{MSAp2}

  % \judgment{
    % \ctxSynTypeM{\ctx}{\ECMV_1}{\TMV} \\
    % \notMatchedArrow{\TMV} \\
    % \ctxAnaTypeM{\ctx}{\ECMV_2}{\TUnknown}
  % }{
    % \ctxSynTypeM{\ctx}{\ECApNonMatchedAlt{\ECMV}{\ECMV}}{\TUnknown}
  % }{MSAp2}

  \judgment{
    \ctxSynTypeM{\ctx}{\ECMV_1}{\TMV} \\
    \notMatchedArrow{\TMV} \\
    \ctxAnaTypeM{\ctx}{\ECMV_2}{\TUnknown}
  }{
    \ctxSynTypeM{\ctx}{\ECApSynNonMatchedArrow{\ECMV}{\ECMV}}{\TUnknown}
  }{MSAp2}

  \judgment{
    \ctxSynTypeM{\ctx}{\ECMV_1}{\TMV_1} \\
    \ctxSynTypeM{\extendCtx{\ctx}{x}{\TMV_1}}{\ECMV_2}{\TMV_2}
  }{
    \ctxSynTypeM{\ctx}{\ECLet{x}{\ECMV_1}{\ECMV_2}}{\TMV_2}
  }{MSLet}

  \judgment{ }{
    \ctxSynTypeM{\ctx}{\ECNumMV}{\TNum}
  }{MSNum}

  \judgment{
    \ctxAnaTypeM{\ctx}{\ECMV_1}{\TNum} \\
    \ctxAnaTypeM{\ctx}{\ECMV_2}{\TNum}
  }{
    \ctxSynTypeM{\ctx}{\ECPlus{\ECMV_1}{\ECMV_2}}{\TNum}
  }{MSPlus}

  \judgment{ }{
    \ctxSynTypeM{\ctx}{\ECTrue}{\TBool}
  }{MSTrue}

  \judgment{ }{
    \ctxSynTypeM{\ctx}{\ECFalse}{\TBool}
  }{MSFalse}

  \judgment{
    \ctxAnaTypeM{\ctx}{\ECMV_1}{\TBool} \\
    \ctxSynTypeM{\ctx}{\ECMV_2}{\TMV_1} \\
    \ctxSynTypeM{\ctx}{\ECMV_3}{\TMV_2}
  }{
    \ctxSynTypeM{\ctx}{\ECIf{\ECMV_1}{\ECMV_2}{\ECMV_3}}{\TJoin{\TMV_1}{\TMV_2}}
  }{MSIf}

  \judgment{
    \ctxAnaTypeM{\ctx}{\ECMV_1}{\TBool} \\
    \ctxSynTypeM{\ctx}{\ECMV_2}{\TMV_1} \\
    \ctxSynTypeM{\ctx}{\ECMV_3}{\TMV_2} \\
    \inconsistent{\TMV_1}{\TMV_2}
  }{
    \ctxSynTypeM{\ctx}{\ECInconBr{\ECMV_1}{\ECMV_2}{\ECMV_3}}{\TUnknown}
  }{MSInconsistentBranches}

  \judgment{
    \ctxSynTypeM{\ctx}{\ECMV_1}{\TMV_1} \\
    \ctxSynTypeM{\ctx}{\ECMV_2}{\TMV_2}
  }{
    \ctxSynTypeM{\ctx}{\ECPair{\ECMV_1}{\ECMV_2}}{\TProd{\TMV_1}{\TMV_2}}
  }{MSPair}

  \judgment{
    \ctxSynTypeM{\ctx}{\ECMV}{\TMV} \\
    \matchedProd{\TMV}{\TMV_1}{\TMV_2}
  }{
    \ctxSynTypeM{\ctx}{\ECProjL{\ECMV}}{\TMV_1}
  }{MSProjL1}

  \judgment{
    \ctxSynTypeM{\ctx}{\ECMV}{\TMV} \\
    \notMatchedProd{\TMV}
  }{
    \ctxSynTypeM{\ctx}{\ECProjLSynNonMatchedProd{\ECMV}}{\TUnknown}
  }{MSProjL2}

  \judgment{
    \ctxSynTypeM{\ctx}{\ECMV}{\TMV} \\
    \matchedProd{\TMV}{\TMV_1}{\TMV_2}
  }{
    \ctxSynTypeM{\ctx}{\ECProjR{\ECMV}}{\TMV_2}
  }{MSProjR1}

  \judgment{
    \ctxSynTypeM{\ctx}{\ECMV}{\TMV} \\
    \notMatchedProd{\TMV}
  }{
    \ctxSynTypeM{\ctx}{\ECProjRSynNonMatchedProd{\ECMV}}{\TUnknown}
  }{MSProjR2}
\end{mathpar} \\

\judgbox{\ctxAnaTypeM{\ctx}{\ECMV}{\TMV}} $\ECMV$ analyzes against type $\TMV$
%
\begin{mathpar}
  \judgment{
    \matchedArrow{\TMV_3}{\TMV_1}{\TMV_2} \\
    \consistent{\TMV}{\TMV_1} \\
    \ctxAnaTypeM{\extendCtx{\ctx}{x}{\TMV}}{\ECMV}{\TMV_2}
  }{
    \ctxAnaTypeM{\ctx}{\ECLam{x}{\TMV}{\ECMV}}{\TMV_3}
  }{MALam1}

  \judgment{
    \notMatchedArrow{\TMV_3} \\
    \ctxAnaTypeM{\extendCtx{\ctx}{x}{\TMV}}{\ECMV}{\TUnknown}
  }{
    \ctxAnaTypeM{\ctx}{\ECLamAnaNonMatchedArrow{x}{\TMV}{\ECMV}}{\TMV_3}
  }{MALam2}

  \judgment{
    \matchedArrow{\TMV_3}{\TMV_1}{\TMV_2} \\
    \inconsistent{\TMV}{\TMV_1} \\
    \ctxAnaTypeM{\extendCtx{\ctx}{x}{\TMV_1}}{\ECMV}{\TMV_2}
  }{
    \ctxAnaTypeM{\ctx}{\ECLamInconAsc{x}{\TMV}{\ECMV}}{\TMV_3}
  }{MALam3}

  \judgment{
    \ctxSynTypeM{\ctx}{\ECMV_1}{\TMV_1} \\
    \ctxAnaTypeM{\extendCtx{\ctx}{x}{\TMV_1}}{\ECMV_2}{\TMV_2}
  }{
    \ctxAnaTypeM{\ctx}{\ECLet{x}{\ECMV_1}{\ECMV_2}}{\TMV_2}
  }{MALet}

  \judgment{
    \ctxAnaTypeM{\ctx}{\ECMV_1}{\TBool} \\
    \ctxAnaTypeM{\ctx}{\ECMV_1}{\TMV} \\
    \ctxAnaTypeM{\ctx}{\ECMV_2}{\TMV}
  }{
    \ctxAnaTypeM{\ctx}{\ECIf{\ECMV_1}{\ECMV_2}{\ECMV_3}}{\TMV}
  }{MAIf}

  \judgment{
    \matchedProd{\TMV}{\TMV_1}{\TMV_2} \\
    \ctxAnaTypeM{\ctx}{\ECMV_1}{\TMV_1} \\
    \ctxAnaTypeM{\ctx}{\ECMV_2}{\TMV_2}
  }{
    \ctxAnaTypeM{\ctx}{\ECPair{\ECMV_1}{\ECMV_2}}{\TMV}
  }{MAPair1}

  \judgment{
    \notMatchedProd{\TMV} \\
    \ctxAnaTypeM{\ctx}{\ECMV_1}{\TUnknown} \\
    \ctxAnaTypeM{\ctx}{\ECMV_2}{\TUnknown}
  }{
    \ctxAnaTypeM{\ctx}{\ECPairAnaNonMatchedProd{\ECMV_1}{\ECMV_2}}{\TMV}
  }{MAPair2}

  \judgment{
    \ctxSynTypeM{\ctx}{\ECMV}{\TMV'} \\
    \inconsistent{\TMV}{\TMV'} \\
    \subsumable{\ECMV}
  }{
    \ctxAnaTypeM{\ctx}{\ECInconType{\ECMV}}{\TMV}
  }{MAInconsistentTypes}

  \judgment{
    \ctxSynTypeM{\ctx}{\ECMV}{\TMV'} \\
    \consistent{\TMV}{\TMV'} \\
    \subsumable{\ECMV}
  }{
    \ctxAnaTypeM{\ctx}{\ECMV}{\TMV}
  }{MASubsume}
\end{mathpar} \\

\judgbox{\subsumable{\ECMV}} $\ECMV$ is subsumable
%
\begin{mathpar}
  \judgment{ }{
    \subsumable{\ECEHole}
  }{MSuHole}

  \judgment{ }{
    \subsumable{x}
  }{MSuVar}

  \judgment{ }{
    \subsumable{\ECUnbound{x}}
  }{MSuUnbound}

  \judgment{ }{
    \subsumable{\ECAp{\ECMV_1}{\ECMV_2}}
  }{MSuAp}

  \judgment{ }{
    \subsumable{\ECNumMV}
  }{MSuNum}

  \judgment{ }{
    \subsumable{\ECPlus{\ECMV_1}{\ECMV_2}}
  }{MSuPlus}

  \judgment{ }{
    \subsumable{\ECTrue}
  }{MSuTrue}

  \judgment{ }{
    \subsumable{\ECFalse}
  }{MSuFalse}

  \judgment{ }{
    \subsumable{\ECInconBr{\ECMV_1}{\ECMV_2}{\ECMV_3}}
  }{MSuInconsistentBranches}

  \judgment{ }{
    \subsumable{\ECProjL{\ECMV}}
  }{MSuProjL}

  \judgment{ }{
    \subsumable{\ECProjR{\ECMV}}
  }{MSuProjR}
\end{mathpar} \\

\judgbox{\markless{\ECMV}} $\ECMV$ has no marks
%
\begin{mathpar}
  \judgment{ }{
    \markless{\ECEHole}
  }{MLHole}

  \judgment{ }{
    \markless{x}
  }{MLVar}

  \judgment{
    \markless{\ECMV}
  }{
    \markless{\ECLam{x}{\TMV}{\ECMV}}
  }{MLLam}

  \judgment{
    \markless{\ECMV_1} \\
    \markless{\ECMV_2}
  }{
    \markless{\ECAp{\ECMV_1}{\ECMV_2}}
  }{MLAp}

  \judgment{ }{
    \markless{\ECNumMV}
  }{MLNum}

  \judgment{
    \markless{\ECMV_1} \\
    \markless{\ECMV_2}
  }{
    \markless{\ECPlus{\ECMV_1}{\ECMV_2}}
  }{MLPlus}

  \judgment{ }{
    \markless{\ECTrue}
  }{MLTrue}

  \judgment{ }{
    \markless{\ECFalse}
  }{MLFalse}

  \judgment{
    \markless{\ECMV_1} \\
    \markless{\ECMV_2} \\
    \markless{\ECMV_3}
  }{
    \markless{\ECIf{\ECMV_1}{\ECMV_2}{\ECMV_3}}
  }{MLIf}
\end{mathpar}

\subsection{Mark Erasure}
$\judgbox{\erase{\ECMV}}$ is a metafunction defined as follows:
%
\newcommand{\erasesToRow}[2]{\erase{#1} & = & #2}
\[\begin{array}{rcl}
  \erasesToRow{\ECEHole}{\EEHole} \\
  \erasesToRow{x}{x} \\
  \erasesToRow{(\ECLam{x}{\TMV}{\ECMV})}{\ELam{x}{\TMV}{(\erase{\ECMV})}} \\
  \erasesToRow{(\ECAp{\ECMV_1}{\ECMV_2})}{\EAp{(\erase{\ECMV_1})}{(\erase{\ECMV_2})}} \\
  \erasesToRow{(\ECLet{x}{\ECMV_1}{\ECMV_2})}{\ELet{x}{(\erase{\ECMV_1})}{(\erase{\ECMV_2})}} \\
  \erasesToRow{\ECNumMV}{\ENumMV} \\
  \erasesToRow{(\ECPlus{\ECMV_1}{\ECMV_2})}{\EPlus{(\erase{\ECMV_1})}{(\erase{\ECMV_2})}} \\
  \erasesToRow{\ECTrue}{\ETrue} \\
  \erasesToRow{\ECFalse}{\EFalse} \\
  \erasesToRow{(\ECIf{\ECMV_1}{\ECMV_2}{\ECMV_3})}{\EIf{(\erase{\ECMV_1})}{(\erase{\ECMV_2})}{(\erase{\ECMV_3})}} \\
  \erasesToRow{\ECUnbound{x}}{x} \\
  \erasesToRow{\ECInconType{\ECMV}}{\erase{\ECMV}} \\
  \erasesToRow{\ECInconBr{\ECMV_1}{\ECMV_2}{\ECMV_3}}{\EIf{(\erase{\ECMV_1})}{(\erase{\ECMV_2})}{(\erase{\ECMV_3})}} \\
\end{array}\]

\subsection{Metatheorems}
\begin{theorem}[name=Marking Totality] \
  \begin{enumerate}
    \item For all $\ctx$ and $\EMV$, there exist $\ECMV$ and $\TMV$ such that
      $\ctxSynFixedInto{\ctx}{\EMV}{\ECMV}{\TMV}$.
    \item For all $\ctx$, $\EMV$, and $\TMV$, there exists $\ECMV$ such that
      $\ctxAnaFixedInto{\ctx}{\EMV}{\ECMV}{\TMV}$.
  \end{enumerate}
\end{theorem}

\begin{theorem}[name=Marking Well-Formedness] \
  \begin{enumerate}
    \item If $\ctxSynFixedInto{\ctx}{\EMV}{\ECMV}{\TMV}$, then $\ctxSynTypeM{\ctx}{\ECMV}{\TMV}$ and
      $\erasesTo{\ECMV}{\EMV}$.
    \item If $\ctxAnaFixedInto{\ctx}{\EMV}{\ECMV}{\TMV}$, then $\ctxAnaTypeM{\ctx}{\ECMV}{\TMV}$ and
      $\erasesTo{\ECMV}{\EMV}$.
  \end{enumerate}
\end{theorem}

\begin{theorem}[name=Marking of Well-Typed/Ill-Typed Expressions] \
  \begin{enumerate}
    \item \begin{enumerate}
        \item If $\ctxSynTypeU{\ctx}{\EMV}{\TMV}$ and $\ctxSynFixedInto{\ctx}{\EMV}{\ECMV}{\TMV}$,
          then $\markless{\ECMV}$.
        \item If $\ctxAnaTypeU{\ctx}{\EMV}{\TMV}$ and $\ctxAnaFixedInto{\ctx}{\EMV}{\ECMV}{\TMV}$,
          then $\markless{\ECMV}$.
      \end{enumerate}

    \item \begin{enumerate}
        \item If there does not exist $\TMV$ such that $\ctxSynTypeU{\ctx}{\EMV}{\TMV}$, then for
          all $\ECMV$ and $\TMV'$ such that $\ctxSynFixedInto{\ctx}{\EMV}{\ECMV}{\TMV'}$, it is not
          the case that $\markless{\ECMV}$.
        \item If there does not exist $\TMV$ such that $\ctxAnaTypeU{\ctx}{\EMV}{\TMV}$, then for
          all $\ECMV$ and $\TMV'$ such that $\ctxAnaFixedInto{\ctx}{\EMV}{\ECMV}{\TMV'}$, it is not
          the case that $\markless{\ECMV}$.
      \end{enumerate}
  \end{enumerate}
\end{theorem}

\begin{theorem}[name=Marking Unicity] \
  \begin{enumerate}
    \item If $\ctxSynFixedInto{\ctx}{\EMV}{\ECMV_1}{\TMV_1}$ and
      $\ctxSynFixedInto{\ctx}{\EMV}{\ECMV_2}{\TMV_2}$, then $\ECMV_1 = \ECMV_2$ and $\TMV_1 =
      \TMV_2$.
    \item If $\ctxAnaFixedInto{\ctx}{\EMV}{\ECMV_1}{\TMV}$ and
      $\ctxAnaFixedInto{\ctx}{\EMV}{\ECMV_2}{\TMV}$, then $\ECMV_1 = \ECMV_2$.
  \end{enumerate}
\end{theorem}

\subsection{Alternative Conditional Rules}
\judgbox{\ctxSynTypeU{\ctx}{\EMV}{\TMV}} $\EMV$ synthesizes type $\TMV$
%
\begin{mathpar}
  \judgment{
    \ctxAnaTypeU{\ctx}{\EMV_1}{\TBool} \\
    \ctxSynTypeU{\ctx}{\EMV_2}{\TMV} \\
    \ctxAnaTypeU{\ctx}{\EMV_3}{\TMV}
  }{
    \ctxSynTypeU{\ctx}{\EIf{\EMV_1}{\EMV_2}{\EMV_3}}{\TMV}
  }{USIf'}
\end{mathpar}

\judgbox{\ctxSynFixedInto{\ctx}{\EMV}{\ECMV}{\TMV}} $\EMV$ is marked into $\ECMV$ and synthesizes type $\TMV$
%
\begin{mathpar}
  \judgment{
    \ctxAnaFixedInto{\ctx}{\EMV_1}{\ECMV_1}{\TBool} \\
    \ctxSynFixedInto{\ctx}{\EMV_2}{\ECMV_2}{\TMV} \\
    \ctxAnaFixedInto{\ctx}{\EMV_3}{\ECMV_3}{\TMV}
  }{
    \ctxSynFixedInto{\ctx}{\EIf{\EMV_1}{\EMV_2}{\EMV_3}}{\ECIf{\ECMV_1}{\ECMV_2}{\ECMV_3}}{\TMV}
  }{MKSIf'}
\end{mathpar}

\judgbox{\ctxSynTypeM{\ctx}{\ECMV}{\TMV}} $\ECMV$ synthesizes type $\TMV$
%
\begin{mathpar}
  \judgment{
    \ctxAnaTypeM{\ctx}{\ECMV_1}{\TBool} \\
    \ctxSynTypeM{\ctx}{\ECMV_2}{\TMV} \\
    \ctxAnaTypeM{\ctx}{\ECMV_3}{\TMV}
  }{
    \ctxSynTypeM{\ctx}{\ECIf{\ECMV_1}{\ECMV_2}{\ECMV_3}}{\TMV}
  }{MSIf}
\end{mathpar}

\subsection{Patterned Let Expressions}
\subsubsection{Syntax}
\[\begin{array}{rrcl}
  \TMName  & \TMV  & \Coloneqq & \cdots \mid \TUnknownSwitch \\
  \EMName  & \EMV  & \Coloneqq & \cdots \mid \ELet{\PMV}{\EMV}{\EMV} \\
  \ECMName & \ECMV & \Coloneqq & \cdots \mid \ECLet{\PMV}{\ECMV}{\ECMV} \\
  \PMName  & \PMV  & \Coloneqq & \PWild \mid \PVar{x} \mid \PPair{\PMV}{\PMV} \mid \PAsc{\PMV}{\TMV} \\
  \PCMName & \PCMV & \Coloneqq & \PCWild \mid \PCVar{x} \mid \PCPair{\PCMV}{\PCMV} \mid \PCAsc{\PCMV}{\TMV}
                               \mid \PCInconType{\PCMV} \mid \PCAnaNonMatchedProd{\PCMV}
\end{array}\]

\subsubsection{Unmarked Expressions}
\judgbox{\ctxSynTypeU{\ctx}{\EMV}{\TMV}} $\EMV$ synthesizes type $\TMV$
%
\begin{mathpar}
  \judgment{
    \ctxSynPatU{\ctx}{\PMV}{\TMV_p} \\
    \ctxAnaTypeU{\ctx}{\EMV_{1}}{\TMV_p} \\
    \ctxSynTypeU{\ctx}{\EMV_{1}}{\TMV_{1}} \\\\
    \ctxAnaPatU{\ctx}{\PMV}{\TMV_{1}}{\ctx'} \\
    \ctxSynTypeU{\ctx'}{\EMV_{2}}{\TMV_2}
  }{
    \ctxSynTypeU{\ctx}{\ELet{\PMV}{\EMV_{1}}{\EMV_{2}}}{\TMV_2}
  }{USLetPat}
\end{mathpar}

\judgbox{\ctxAnaTypeU{\ctx}{\EMV}{\TMV}} $\EMV$ analyzes against type $\TMV$
%
\begin{mathpar}
  \judgment{
    \ctxSynTypeU{\ctx}{\EMV}{\ctx'}
  }{
    \ctxAnaTypeU{\ctx}{\EMV}{\TUnknownSwitch}
  }{UASynSwitch}

  \judgment{
    \ctxSynPatU{\ctx}{\PMV}{\TMV_p} \\
    \ctxAnaTypeU{\ctx}{\EMV_{1}}{\TMV_p} \\
    \ctxSynTypeU{\ctx}{\EMV_{1}}{\TMV_{1}} \\\\
    \ctxAnaPatU{\ctx}{\PMV}{\TMV_{1}}{\ctx'} \\
    \ctxAnaTypeU{\ctx'}{\EMV_{2}}{\TMV_2}
  }{
    \ctxAnaTypeU{\ctx}{\ELet{\PMV}{\EMV_{1}}{\EMV_{2}}}{\TMV_2}
  }{UALetPat}
\end{mathpar}

\subsubsection{Marking}
\judgbox{\ctxSynFixedInto{\ctx}{\EMV}{\ECMV}{\TMV}} $\EMV$ is marked into $\ECMV$ and synthesizes type $\TMV$
%
\begin{mathpar}
  \judgment{
    \ctxSynFixedInto{\ctx}{\PMV}{\PCMV}{\TMV_p} \\
    \ctxAnaFixedInto{\ctx}{\EMV_{1}}{\ECMV_{1}}{\TMV_{p}} \\\\
    \ctxSynTypeU{\ctx}{\EMV_{1}}{\TMV_{1}} \\
    \ctxAnaPatU{\ctx}{\PMV}{\TMV_{1}}{\ctx'} \\
    \ctxSynFixedInto{\ctx'}{\EMV_{2}}{\ECMV_{2}}{\TMV_2}
  }{
    \ctxSynFixedInto{\ctx}{\ELet{\PMV}{\EMV_{1}}{\EMV_{2}}}{\ELet{\PCMV}{\ECMV_{1}}{\ECMV_{2}}}{\TMV_2}
  }{ISLetPat}
\end{mathpar} \\

\judgbox{\ctxAnaFixedInto{\ctx}{\EMV}{\ECMV}{\TMV}} $\EMV$ is marked into $\ECMV$ and analyzes against type $\TMV$
%
\begin{mathpar}
  \judgment{
    \ctxSynFixedInto{\ctx}{\PMV}{\PCMV}{\TMV_p} \\
    \ctxAnaFixedInto{\ctx}{\EMV_{1}}{\ECMV_{1}}{\TMV_{p}} \\\\
    \ctxSynTypeU{\ctx}{\EMV_{1}}{\TMV_{1}} \\
    \ctxAnaPatU{\ctx}{\PMV}{\TMV_{1}}{\ctx'} \\
    \ctxAnaFixedInto{\ctx'}{\EMV_{2}}{\ECMV_{2}}{\TMV_2}
  }{
    \ctxAnaFixedInto{\ctx}{\ELet{\PMV}{\EMV_{1}}{\EMV_{2}}}{\ELet{\PCMV}{\ECMV_{1}}{\ECMV_{2}}}{\TMV_2}
  }{IALetPat}
\end{mathpar}

\subsubsection{Marked Expressions}
\judgbox{\ctxSynTypeM{\ctx}{\ECMV}{\TMV}} $\ECMV$ synthesizes type $\TMV$
%
\begin{mathpar}
  \judgment{
    \ctxSynPatM{\ctx}{\PCMV}{\TMV_p} \\
    \ctxAnaTypeM{\ctx}{\ECMV_{1}}{\TMV_p} \\
    \ctxSynTypeM{\ctx}{\ECMV_{1}}{\TMV_{1}} \\\\
    \ctxAnaPatM{\ctx}{\PCMV}{\TMV_{1}}{\ctx'} \\
    \ctxSynTypeM{\ctx'}{\ECMV_{2}}{\TMV_2}
  }{
    \ctxSynTypeM{\ctx}{\ELet{\PCMV}{\ECMV_{1}}{\ECMV_{2}}}{\TMV_2}
  }{MSLetPat}
\end{mathpar}

\judgbox{\ctxAnaTypeM{\ctx}{\ECMV}{\TMV}} $\ECMV$ analyzes against type $\TMV$
%
\begin{mathpar}
  \judgment{
    \ctxSynPatM{\ctx}{\PCMV}{\TMV_p} \\
    \ctxAnaTypeM{\ctx}{\ECMV_{1}}{\TMV_p} \\
    \ctxSynTypeM{\ctx}{\ECMV_{1}}{\TMV_{1}} \\\\
    \ctxAnaPatM{\ctx}{\PCMV}{\TMV_{1}}{\ctx'} \\
    \ctxAnaTypeM{\ctx'}{\ECMV_{2}}{\TMV_2}
  }{
    \ctxAnaTypeM{\ctx}{\ELet{\PCMV}{\ECMV_{1}}{\ECMV_{2}}}{\TMV_2}
  }{MALetPat}
\end{mathpar}

\subsubsection{Unmarked Patterns}
\judgbox{\ensuremath{\ctxSynPatU{\ctx}{\PMV}{\TMV}}} $\PMV$ synthesizes type $\TMV$
%
\begin{mathpar}
  \judgment{ }{
    \ctxSynPatU{\ctx}{\PWild}{\TUnknownSwitch}
  }{USPWild}
 
  \judgment{ }{
    \ctxSynPatU{\ctx}{\PVar{x}}{\TUnknownSwitch}
  }{USPVar}

  \judgment{
    \ctxSynPatU{\ctx}{\PMV_1}{\TMV_1} \\
    \ctxSynPatU{\ctx}{\PMV_2}{\TMV_2}
  }{
    \ctxSynPatU{\ctx}{\PPair{\PMV_1}{\PMV_2}}{\TProd{\TMV_1}{\TMV_2}}
  }{USPPair}
 
  \judgment{
    \ctxAnaPatU{\ctx}{\PMV}{\TMV}{\ctx'}
  }{
    \ctxSynPatU{\ctx}{\PAsc{\PMV}{\TMV}}{\TMV}
  }{USPAnn}
\end{mathpar}

\judgbox{\ensuremath{\ctxAnaPatU{\ctx_1}{\PMV}{\TMV}{\ctx_2}}} $\PMV$ analyzes against type $\TMV$ producing context $\ctx_2$
%
\begin{mathpar}
  \judgment{ }{
    \ctxAnaPatU{\ctx}{\PWild}{\TMV}{\ctx}
  }{UAPWild}
 
  \judgment{ }{
    \ctxAnaPatU{\ctx}{\PVar{x}}{\TMV}{\extendCtx{\ctx}{x}{\TMV}}
  }{UAPVar}

  \judgment{
    \matchedProd{\TMV}{\TMV_1}{\TMV_2} \\
    \ctxAnaPatU{\ctx}{\PMV_1}{\TMV_1}{\ctx_1} \\
    \ctxAnaPatU{\ctx_1}{\PMV_2}{\TMV_2}{\ctx_2}
  }{
    \ctxAnaPatU{\ctx}{\PPair{\PMV_1}{\PMV_2}}{\TMV}{\ctx_2}
  }{UAPPair}
 
  \judgment{
    \ctxAnaPatU{\ctx}{\PMV}{\TMV'}{\ctx'} \\
    \consistent{\TMV}{\TMV'}
  }{
    \ctxAnaPatU{\ctx}{\PAsc{\PMV}{\TMV'}}{\TMV}{\ctx'}
  }{UAPAnn}
\end{mathpar}

\subsubsection{Pattern Marking}
\judgbox{\ensuremath{\ctxSynFixedIntoPat{\ctx}{\PMV}{\PCMV}{\TMV}}} $\PMV$ is marked into $\PCMV$ and synthesizes $\TMV$
 %
\begin{mathpar}
  \judgment{ }{
    \ctxSynFixedIntoPat{\ctx}{\PWild}{\PCWild}{\TUnknownSwitch}
  }{ISPWild}
   
  \judgment{ }{
    \ctxSynFixedIntoPat{\ctx}{\PVar{x}}{\PCVar{x}}{\TUnknownSwitch}
  }{ISPVar}

  \judgment{
    \ctxSynFixedIntoPat{\ctx}{\PMV_1}{\PCMV_1}{\TMV_1} \\\\
    \ctxSynFixedIntoPat{\ctx}{\PMV_2}{\PCMV_2}{\TMV_2}
  }{
     \ctxSynFixedIntoPat{\ctx}{\EPair{\PMV_1}{\PMV_2}}{\ECPair{\PCMV_1}{\PCMV_2}}{\TProd{\TMV_1}{\TMV_2}}
  }{ISPPair}

  \judgment{
    \ctxAnaPatU{\ctx}{\PMV{}}{\TMV}{\ctx'} \\
    \ctxAnaFixedIntoPat{\ctx}{\PMV}{\PCMV}{\TMV}{\ctx''}
  }{
    \ctxSynFixedIntoPat{\ctx}{\PAsc{\PMV}{\TMV}}{\PCAsc{\PCMV}{\TMV}}{\tau}
  }{ISPAnn1}

  \judgment{
    \ctxNotAnaPatU{\ctx}{\PMV{}}{\TMV}{\ctx'} \\
    \ctxAnaFixedIntoPat{\ctx}{\PMV}{\PCMV}{\TUnknown}{\ctx''}
  }{
    \ctxSynFixedIntoPat{\ctx}{\PAsc{\PMV}{\TMV}}{\PCAsc{\PCInconType{\PCMV}}{\TMV}}{\TMV}
  }{ISPAnn2}
\end{mathpar}

\judgbox{\ensuremath{\ctxAnaFixedIntoPat{\ctx_1}{\PMV}{\PCMV}{\TMV}{\ctx_2}}} $\PMV$ is marked into $\PCMV$ and analyzes against $\TMV$ producing $\ctx_2$
%
\begin{mathpar}
  \judgment{ }{
    \ctxAnaFixedIntoPat{\ctx}{\PWild}{\PCWild}{\TMV}{\ctx}
  }{IAPWild}
   
  \judgment{ }{
    \ctxAnaFixedIntoPat{\ctx}{\PVar{x}}{\PCVar{x}}{\TMV}{\extendCtx{\ctx}{x}{\TMV}}
  }{IAPVar}

  \judgment{
    \matchedProd{\TMV}{\TMV_1}{\TMV_2} \\
    \ctxAnaFixedIntoPat{\ctx}{\PMV_1}{\PCMV_1}{\TMV_1}{\ctx_1} \\\\
    \ctxAnaFixedIntoPat{\ctx_1}{\PMV_2}{\PCMV_2}{\TMV_2}{\ctx_2}
  }{
    \ctxAnaFixedIntoPat{\ctx}{\PPair{\PMV_1}{\PMV_2}}{\PCPair{\PCMV_1}{\PCMV_2}}{\TMV}{\ctx_2}
  }{IAPPair1}

  \judgment{
    \notMatchedProd{\TMV} \\
    \ctxAnaFixedIntoPat{\ctx}{\PMV_1}{\PCMV_1}{\TUnknown}{\ctx_1} \\\\
    \ctxAnaFixedIntoPat{\ctx_1}{\PMV_2}{\PCMV_2}{\TUnknown}{\ctx_2}
  }{
    \ctxAnaFixedIntoPat{\ctx}{\PPair{\PMV_1}{\PMV_2}}{\PCAnaNonMatchedProd{\PCPair{\PCMV_1}{\PCMV_2}}}{\TMV}{\ctx_2}
  }{IAPPair2}

  \judgment{
    \consistent{\TMV}{\TMV'} \\
    \ctxAnaFixedIntoPat{\ctx}{\PMV}{\PCMV}{\TMV'}{\ctx'}
  }{
    \ctxAnaFixedIntoPat{\ctx}{\PAsc{\PMV}{\TMV'}}{\PCAsc{\PCMV}{\TMV'}}{\TMV}{\ctx'}
  }{IAPAnn1}

  \judgment{
    \inconsistent{\TMV}{\TMV'} \\
    \ctxAnaFixedIntoPat{\ctx}{\PMV}{\PCMV}{\TMV'}{\ctx'}
  }{
    \ctxAnaFixedIntoPat{\ctx}{\PAsc{\PMV}{\TMV'}}{\PCInconType{\PCAsc{\PCMV}{\TMV'}}}{\TMV}{\ctx'}
  }{IAPAnn2}
\end{mathpar}

\subsubsection{Marked Patterns}
\judgbox{\ensuremath{\ctxSynPatM{\ctx}{\PCMV}{\TMV}}} $\PCMV$ synthesizes type $\TMV$
%
\begin{mathpar}
  \judgment{ }{
    \ctxSynPatM{\ctx}{\PCWild}{\TUnknownSwitch}
  }{MSPWild}

  \judgment{ }{
    \ctxSynPatM{\ctx}{\PCVar{x}}{\TUnknownSwitch}
  }{MSPVar}

  \judgment{
    \ctxSynPatM{\ctx}{\PCMV_1}{\TMV_1} \\
    \ctxSynPatM{\ctx}{\PCMV_2}{\TMV_2}
  }{
    \ctxSynPatM{\ctx}{\PCPair{\PCMV_1}{\PCMV_2}}{\TProd{\TMV_1}{\TMV_2}}
  }{MSPPair}

  \judgment{
    \ctxAnaPatM{\ctx}{\PCMV}{\TMV}{\ctx'}
  }{
    \ctxSynPatM{\ctx}{\PCAsc{\PCMV}{\TMV}}{\TMV}
  }{MSPAnn}
\end{mathpar}

\judgbox{\ensuremath{\ctxAnaPatM{\ctx_1}{\PCMV}{\TMV}{\ctx_2}}} $\PCMV$ analyzes against type $\TMV$ producing context $\ctx_2$
%
\begin{mathpar}
  \judgment{ }{
    \ctxAnaPatM{\ctx}{\PCWild}{\TMV}{\ctx}
  }{MAPWild}
   
  \judgment{ }{
    \ctxAnaPatM{\ctx}{\PCVar{x}}{\TMV}{\extendCtx{\ctx}{x}{\TMV}}
  }{MAPVar}

  \judgment{
    \matchedProd{\TMV}{\TMV_1}{\TMV_2} \\
    \ctxAnaPatM{\ctx}{\PCMV_1}{\TMV_1}{\ctx_1} \\\\
    \ctxAnaPatM{\ctx_1}{\PCMV_2}{\TMV_2}{\ctx_2}
  }{
    \ctxAnaPatM{\ctx}{\PCPair{\PCMV_1}{\PCMV_2}}{\TMV}{\ctx_2}
  }{MAPPair1}

  \judgment{
    \notMatchedProd{\TMV} \\
    \ctxAnaPatM{\ctx}{\PCMV_1}{\TUnknown}{\ctx_1} \\\\
    \ctxAnaPatM{\ctx_1}{\PCMV_2}{\TUnknown}{\ctx_2}
  }{
    \ctxAnaPatM{\ctx}{\PCAnaNonMatchedProd{\PCPair{\PCMV_1}{\PCMV_2}}}{\TMV}{\ctx_2}
  }{MAPPair2}

  \judgment{
    \consistent{\TMV}{\TMV'} \\
    \ctxAnaPatM{\ctx}{\PCMV}{\TMV'}{\ctx'}
  }{
    \ctxAnaPatM{\ctx}{\PCAsc{\PCMV}{\TMV'}}{\TMV}{\ctx'}
  }{MAPAnn1}

  \judgment{
    \inconsistent{\TMV}{\TMV'} \\
    \ctxAnaPatM{\ctx}{\PCMV}{\TMV'}{\ctx'}
  }{
    \ctxAnaPatM{\ctx}{\PCInconType{\PCAsc{\PCMV}{\TMV'}}}{\TMV}{\ctx'}
  }{MAPAnn2}
\end{mathpar}

\newpage
\section{Untyped Hazelnut}

\subsection{Syntax}
\[\begin{array}{rrcl}
  \ZTMName & \ZTMV & \Coloneqq & \ZTCursor{\TMV} \mid \ZTArrowL{\ZTMV}{\TMV} \mid \ZTArrowR{\TMV}{\ZTMV} \mid \ZTProdL{\ZTMV}{\TMV} \mid \ZTProdR{\TMV}{\ZTMV} \\
  \ZMName  & \ZMV  & \Coloneqq & \ZCursor{\EMV} \mid \ZLamT{x}{\ZTMV}{\EMV} \mid \ZLamE{x}{\TMV}{\ZMV} \mid \ZApL{\ZMV}{\EMV} \mid \ZApR{\EMV}{\ZMV} \\
           &       & \mid         & \ZLetL{x}{\ZMV}{\EMV} \mid \ZLetR{x}{\EMV}{\ZMV} \\
           &       & \mid         & \ZPlusL{\ZMV}{\EMV} \mid \ZPlusR{\EMV}{\ZMV} \\
           &       & \mid         & \ZIfC{\ZMV}{\EMV}{\EMV} \mid \ZIfL{\EMV}{\ZMV}{\EMV} \mid \ZIfR{\EMV}{\EMV}{\ZMV} \\
           &       & \mid         & \ZPairL{\ZMV}{\EMV} \mid \ZPairR{\EMV}{\ZMV} \mid \ZProjL{\ZMV} \mid \ZProjR{\ZMV} \\
\end{array}\]

\subsection{Cursor Erasure}
\subsubsection{Type Cursor Erasure}
\judgbox{\ensuremath{\cursorErase{\ZTMV}}} is a metafunction defined as follows:
%
\newcommand{\cursorErasesToRow}[2]{\ensuremath{\cursorErase{#1} & = & #2}}
\[\begin{array}{rcl}
  \cursorErasesToRow{\ZTCursor{\TMV}}{\TMV} \\
  \cursorErasesToRow{(\ZTArrowL{\ZTMV}{\TMV})}{\TArrow{\cursorErase{\ZTMV}}{\TMV}} \\
  \cursorErasesToRow{(\ZTArrowR{\TMV}{\ZTMV})}{\TArrow{\TMV}{\cursorErase{\ZTMV}}} \\
  \cursorErasesToRow{(\ZTProdL{\ZTMV}{\TMV})}{\TProd{\cursorErase{\ZTMV}}{\TMV}} \\
  \cursorErasesToRow{(\ZTProdR{\TMV}{\ZTMV})}{\TProd{\TMV}{\cursorErase{\ZTMV}}} \\
\end{array}\]

\subsubsection{Expression Cursor Erasure}
\judgbox{\ensuremath{\cursorErase{\ZMV}}} is a metafunction defined as follows:
%
\[\begin{array}{rcl}
  \cursorErasesToRow{\ZCursor{\EMV}}{\EMV} \\
  \cursorErasesToRow{(\ZLamT{x}{\ZTMV}{\EMV})}{\ELam{x}{\cursorErase{\ZTMV}}{\EMV}} \\
  \cursorErasesToRow{(\ZLamE{x}{\TMV}{\ZMV})}{\ELam{x}{\TMV}{\cursorErase{\ZMV}}} \\
  \cursorErasesToRow{(\ZApL{\ZMV}{\EMV})}{\EAp{\cursorErase{\ZMV}}{\EMV}} \\
  \cursorErasesToRow{(\ZApR{\EMV}{\ZMV})}{\EAp{\EMV}{\cursorErase{\ZMV}}} \\
  \cursorErasesToRow{(\ZLetL{x}{\ZMV}{\EMV})}{\ELet{x}{\cursorErase{\ZMV}}{\EMV}} \\
  \cursorErasesToRow{(\ZLetR{x}{\EMV}{\ZMV})}{\ELet{x}{\EMV}{\cursorErase{\ZMV}}} \\
  \cursorErasesToRow{(\ZPlusL{\ZMV}{\EMV})}{\EPlus{\cursorErase{\ZMV}}{\EMV}} \\
  \cursorErasesToRow{(\ZPlusR{\EMV}{\ZMV})}{\EPlus{\EMV}{\cursorErase{\ZMV}}} \\
  \cursorErasesToRow{(\ZIfC{\ZMV}{\EMV_1}{\EMV_2})}{\EIf{\cursorErase{\ZMV}}{\EMV_1}{\EMV_2}} \\
  \cursorErasesToRow{(\ZIfL{\EMV_1}{\ZMV}{\EMV_2})}{\EIf{\EMV_1}{\cursorErase{\ZMV}}{\EMV_2}} \\
  \cursorErasesToRow{(\ZIfL{\EMV_1}{\EMV_2}{\ZMV})}{\EIf{\EMV_1}{\EMV_2}{\cursorErase{\ZMV}}} \\
  \cursorErasesToRow{(\ZPairL{\ZMV}{\EMV})}{\EPair{\cursorErase{\ZMV}}{\EMV}} \\
  \cursorErasesToRow{(\ZPairR{\EMV}{\ZMV})}{\EPair{\EMV}{\cursorErase{\ZMV}}} \\
  \cursorErasesToRow{(\ZProjL{\ZMV})}{\EProjL{\cursorErase{\ZMV}}} \\
  \cursorErasesToRow{(\ZProjR{\ZMV})}{\EProjR{\cursorErase{\ZMV}}} \\
\end{array}\]

\subsection{Action Model}
\[\begin{array}{rrcl}
  \AMName  & \AMV  & \Coloneqq & \AMove{\MMV} \mid \ACon{\SMV} \mid \ADel \\
  \AIMName & \AIMV & \Coloneqq & \AINil \mid \AICons{\AMV}{\AIMV} \\
  \MMName  & \MMV  & \Coloneqq & \MChild{\MChildNMV} \mid \MParent \\
  \SMName  & \SMV  & \Coloneqq & \STArrowL \mid \STArrowR \mid \STProdL \mid \STProdR \mid \STNum \mid \STBool \\
           &       & \mid         & \SVar{x} \mid \SLam{x} \mid \SApL \mid \SApR \\
           &       & \mid         & \SLetL{x} \mid \SLetR{x} \\
           &       & \mid         & \SLit{n} \mid \SPlusL \mid \SPlusR \\
           &       & \mid         & \STrue \mid \SFalse \mid \SIfC \mid \SIfL \mid \SIfR \\
           &       & \mid         & \SPairL \mid \SPairR \mid \SProjL \mid \SProjR
\end{array}\]

\subsubsection{Shape Sort}
\judgbox{\ensuremath{\tshape{\SMV}}} $\SMV$ is a shape on types
%
\begin{mathpar}
  \judgment{ }{
    \tshape{\STArrowL}
  }{ASortArrow1}

  \judgment{ }{
    \tshape{\STArrowR}
  }{ASortArrow2}

  \judgment{ }{
    \tshape{\STProdL}
  }{ASortProd1}

  \judgment{ }{
    \tshape{\STProdR}
  }{ASortProd2}

  \judgment{ }{
    \tshape{\STNum}
  }{ASortNum}

  \judgment{ }{
    \tshape{\STBool}
  }{ASortBool}
\end{mathpar}

\judgbox{\ensuremath{\eshape{\SMV}}} $\SMV$ is a shape on expressions
%
\begin{mathpar}
  \judgment{ }{
    \eshape{\SVar{x}}
  }{ASortVar}

  \judgment{ }{
    \eshape{\SLam{x}}
  }{ASortLam}

  \judgment{ }{
    \eshape{\SApL}
  }{ASortAp1}

  \judgment{ }{
    \eshape{\SApR}
  }{ASortAp2}

  \judgment{ }{
    \eshape{\SLetL{x}}
  }{ASortLet1}

  \judgment{ }{
    \eshape{\SLetR{x}}
  }{ASortLet2}

  \judgment{ }{
    \eshape{\SLit{n}}
  }{ASortLit}

  \judgment{ }{
    \eshape{\SPlusL}
  }{ASortPlus1}

  \judgment{ }{
    \eshape{\SPlusR}
  }{ASortPlus2}

  \judgment{ }{
    \eshape{\STrue}
  }{ASortTrue}

  \judgment{ }{
    \eshape{\SFalse}
  }{ASortFalse}

  \judgment{ }{
    \eshape{\SIfC}
  }{ASortIf1}

  \judgment{ }{
    \eshape{\SIfL}
  }{ASortIf2}

  \judgment{ }{
    \eshape{\SIfR}
  }{ASortIf3}

  \judgment{ }{
    \eshape{\SPairL}
  }{ASortPairL}

  \judgment{ }{
    \eshape{\SPairR}
  }{ASortPairR}

  \judgment{ }{
    \eshape{\SProjL}
  }{ASortProjL}

  \judgment{ }{
    \eshape{\SProjR}
  }{ASortProjR}
\end{mathpar}

\subsubsection{Type Actions}
\judgbox{\ensuremath{\AUTAction{\ZTMV}{\ZTMV'}{\AMV}}}

\paragraph{Movement}
\begin{mathpar}
  \judgment{ }{
    \AUTMArrowChildL{\TMV_1}{\TMV_2}
  }{ATMArrChild1}

  \judgment{ }{
    \AUTMArrowChildR{\TMV_1}{\TMV_2}
  }{ATMArrChild2}

  \judgment{ }{
    \AUTMArrowParentL{\TMV_1}{\TMV_2}
  }{ATMArrParent1}

  \judgment{ }{
    \AUTMArrowParentR{\TMV_1}{\TMV_2}
  }{ATMArrParent2}

  \judgment{ }{
    \AUTMProdChildL{\TMV_1}{\TMV_2}
  }{ATMProdChild1}

  \judgment{ }{
    \AUTMProdChildR{\TMV_1}{\TMV_2}
  }{ATMProdChild2}

  \judgment{ }{
    \AUTMProdParentL{\TMV_1}{\TMV_2}
  }{ATMProdParent1}

  \judgment{ }{
    \AUTMProdParentR{\TMV_1}{\TMV_2}
  }{ATMProdParent2}
\end{mathpar}

\paragraph{Deletion}
\begin{mathpar}
  \judgment{ }{
    \AUTDel{\TMV}
  }{ATDel}
\end{mathpar}

\paragraph{Construction}
\begin{mathpar}
  \judgment{ }{
    \AUTConArrowL{\TMV}
  }{ATConArrow1}

  \judgment{ }{
    \AUTConArrowR{\TMV}
  }{ATConArrow2}

  \judgment{ }{
    \AUTConProdL{\TMV}
  }{ATConProd1}

  \judgment{ }{
    \AUTConProdR{\TMV}
  }{ATConProd2}

  \judgment{ }{
    \AUTConNum
  }{ATConNum}

  \judgment{ }{
    \AUTConBool
  }{ATConBool}
\end{mathpar}

\paragraph{Zipper Cases}
\begin{mathpar}
  \judgment{
    \AUTAction{\ZTMV}{\ZTMV'}{\AMV}
  }{
    \AUTAction{\ZTArrowL{\ZTMV}{\TMV}}{\ZTArrowL{\ZTMV'}{\TMV}}{\AMV}
  }{ATZipArr1}

  \judgment{
    \AUTAction{\ZTMV}{\ZTMV'}{\AMV}
  }{
    \AUTAction{\ZTArrowR{\TMV}{\ZTMV}}{\ZTArrowR{\TMV}{\ZTMV'}}{\AMV}
  }{ATZipArr2}

  \judgment{
    \AUTAction{\ZTMV}{\ZTMV'}{\AMV}
  }{
    \AUTAction{\ZTProdL{\ZTMV}{\TMV}}{\ZTProdL{\ZTMV'}{\TMV}}{\AMV}
  }{ATZipProd1}

  \judgment{
    \AUTAction{\ZTMV}{\ZTMV'}{\AMV}
  }{
    \AUTAction{\ZTProdR{\TMV}{\ZTMV}}{\ZTProdR{\TMV}{\ZTMV'}}{\AMV}
  }{ATZipProd2}
\end{mathpar}

\subsubsection{Expression Movement}
\judgbox{\ensuremath{\AUEMove{\ZMV}{\ZMV'}{\MMV}}}
%
\begin{mathpar}
  \judgment{ }{
    \AUEMLamChildT{x}{\TMV}{\EMV}
  }{AEMLamChild1}

  \judgment{ }{
    \AUEMLamChildE{x}{\TMV}{\EMV}
  }{AEMLamChild2} \\

  \judgment{ }{
    \AUEMLamParentT{x}{\TMV}{\EMV}
  }{AEMLamParent1}

  \judgment{ }{
    \AUEMLamParentE{x}{\TMV}{\EMV}
  }{AEMLamParent2} \\

  \judgment{ }{
    \AUEMApChildL{\EMV_1}{\EMV_2}
  }{AEMApChild1}

  \judgment{ }{
    \AUEMApChildR{\EMV_1}{\EMV_2}
  }{AEMApChild2} \\

  \judgment{ }{
    \AUEMApParentL{\EMV_1}{\EMV_2}
  }{AEMApParent1}

  \judgment{ }{
    \AUEMApParentR{\EMV_1}{\EMV_2}
  }{AEMApParent2} \\

  \judgment{ }{
    \AUEMLetChildL{x}{\EMV_1}{\EMV_2}
  }{AEMLetChild1}

  \judgment{ }{
    \AUEMLetChildR{x}{\EMV_1}{\EMV_2}
  }{AEMLetChild2} \\

  \judgment{ }{
    \AUEMLetParentL{x}{\EMV_1}{\EMV_2}
  }{AEMLetParent1}

  \judgment{ }{
    \AUEMLetParentR{x}{\EMV_1}{\EMV_2}
  }{AEMLetParent2} \\

  \judgment{ }{
    \AUEMPlusChildL{\EMV_1}{\EMV_2}
  }{AEMPlusChild1}

  \judgment{ }{
    \AUEMPlusChildR{\EMV_1}{\EMV_2}
  }{AEMPlusChild2} \\

  \judgment{ }{
    \AUEMPlusParentL{\EMV_1}{\EMV_2}
  }{AEMPlusParent1}

  \judgment{ }{
    \AUEMPlusParentR{\EMV_1}{\EMV_2}
  }{AEMPlusParent2} \\

  \judgment{ }{
    \AUEMIfChildC{\EMV_1}{\EMV_2}{\EMV_3}
  }{AEMIfChild1}

  \judgment{ }{
    \AUEMIfChildL{\EMV_1}{\EMV_2}{\EMV_3}
  }{AEMIfChild2}

  \judgment{ }{
    \AUEMIfChildR{\EMV_1}{\EMV_2}{\EMV_3}
  }{AEMIfChild3}

  \judgment{ }{
    \AUEMIfParentC{\EMV_1}{\EMV_2}{\EMV_3}
  }{AEMIfParent1}

  \judgment{ }{
    \AUEMIfParentL{\EMV_1}{\EMV_2}{\EMV_3}
  }{AEMIfParent2}

  \judgment{ }{
    \AUEMIfParentR{\EMV_1}{\EMV_2}{\EMV_3}
  }{AEMIfParent3} \\

  \judgment{ }{
    \AUEMPairChildL{\EMV_1}{\EMV_2}
  }{AEMPairChild1}

  \judgment{ }{
    \AUEMPairChildR{\EMV_1}{\EMV_2}
  }{AEMPairChild2} \\

  \judgment{ }{
    \AUEMPairParentL{\EMV_1}{\EMV_2}
  }{AEMPairParent1}

  \judgment{ }{
    \AUEMPairParentR{\EMV_1}{\EMV_2}
  }{AEMPairParent2}

  \judgment{ }{
    \AUEMProjLChild{\EMV_1}
  }{AEMProjLChild}

  \judgment{ }{
    \AUEMProjLParent{\EMV_1}
  }{AEMProjLParent}

  \judgment{ }{
    \AUEMProjRChild{\EMV_1}
  }{AEMProjRChild}

  \judgment{ }{
    \AUEMProjRParent{\EMV_1}
  }{AEMProjRParent}
\end{mathpar}

\subsubsection{Expression Actions}
\judgbox{\ensuremath{\AUEAction{\ZMV}{\ZMV'}{\AMV}}}

\paragraph{Movement}
\begin{mathpar}
  \judgment{
    \AUEMove{\ZMV}{\ZMV'}{\MMV}
  }{
    \AUEMove{\ZMV}{\ZMV'}{\MMV}
  }{AEMove}
\end{mathpar}

\paragraph{Deletion}
\begin{mathpar}
  \judgment{ }{
    \AUEDel{\EMV}
  }{AEDel}
\end{mathpar}

\paragraph{Construction}
\begin{mathpar}
  \judgment{ }{
    \AUEConVar{x}
  }{AEConVar} \\

  \judgment{ }{
    \AUEConLam{x}{\EMV}
  }{AEConLam} \\

  \judgment{ }{
    \AUEConApL{\EMV}
  }{AEConAp1}

  \judgment{ }{
    \AUEConApR{\EMV}
  }{AEConAp2} \\

  \judgment{ }{
    \AUEConLetL{x}{\EMV}
  }{AEConLet1}

  \judgment{ }{
    \AUEConLetR{x}{\EMV}
  }{AEConLet2} \\

  \judgment{ }{
    \AUEConNum{\ENumMV}
  }{AEConNum}

  \judgment{ }{
    \AUEConPlusL{\EMV}
  }{AEConPlus1}

  \judgment{ }{
    \AUEConPlusR{\EMV}
  }{AEConPlus2} \\

  \judgment{ }{
    \AUEConTrue
  }{AEConTrue}

  \judgment{ }{
    \AUEConFalse
  }{AEConFalse} \\
  
  \judgment{ }{
    \AUEConIfC{\EMV}
  }{AEConIf1}
  
  \judgment{ }{
    \AUEConIfL{\EMV}
  }{AEConIf2}
  
  \judgment{ }{
    \AUEConIfR{\EMV}
  }{AEConIf3} \\

  \judgment{ }{
    \AUEConPairL{\EMV}
  }{AEConPair1}

  \judgment{ }{
    \AUEConPairR{\EMV}
  }{AEConPair2} \\

  \judgment{ }{
    \AUEConProjL{\EMV}
  }{AEConProjL}

  \judgment{ }{
    \AUEConProjR{\EMV}
  }{AEConProjR}
\end{mathpar}

\paragraph{Zipper Cases}
\begin{mathpar}
  \judgment{
    \AUTAction{\ZTMV}{\ZTMV'}{\AMV}
  }{
    \AUEAction{\ZLamT{x}{\ZTMV}{\EMV}}{\ZLamT{x}{\ZTMV'}{\EMV}}{\AMV}
  }{AEZipLam1}

  \judgment{
    \AUEAction{\ZMV}{\ZMV'}{\AMV}
  }{
    \AUEAction{\ZLamE{x}{\TMV}{\ZMV}}{\ZLamE{x}{\TMV}{\ZMV'}}{\AMV}
  }{AEZipLam2} \\

  \judgment{
    \AUEAction{\ZMV}{\ZMV'}{\AMV}
  }{
    \AUEAction{\ZApL{\ZMV}{\EMV}}{\ZApL{\ZMV'}{\EMV}}{\AMV}
  }{AEZipAp1}

  \judgment{
    \AUEAction{\ZMV}{\ZMV'}{\AMV}
  }{
    \AUEAction{\ZApR{\EMV}{\ZMV}}{\ZApR{\EMV}{\ZMV'}}{\AMV}
  }{AEZipAp2} \\

  \judgment{
    \AUTAction{\ZMV}{\ZMV'}{\AMV}
  }{
    \AUEAction{\ZLetL{x}{\ZMV}{\EMV}}{\ZLetL{x}{\ZMV'}{\EMV}}{\AMV}
  }{AEZipLet1}

  \judgment{
    \AUEAction{\ZMV}{\ZMV'}{\AMV}
  }{
    \AUEAction{\ZLetR{x}{\EMV}{\ZMV}}{\ZLetR{x}{\EMV}{\ZMV'}}{\AMV}
  }{AEZipLet2} \\

  \judgment{
    \AUEAction{\ZMV}{\ZMV'}{\AMV}
  }{
    \AUEAction{\ZPlusL{\ZMV}{\EMV}}{\ZPlusL{\ZMV'}{\EMV}}{\AMV}
  }{AEZipPlus1}

  \judgment{
    \AUEAction{\ZMV}{\ZMV'}{\AMV}
  }{
    \AUEAction{\ZPlusR{\EMV}{\ZMV}}{\ZPlusR{\EMV}{\ZMV'}}{\AMV}
  }{AEZipPlus2} \\

  \judgment{
    \AUEAction{\ZMV}{\ZMV'}{\AMV}
  }{
    \AUEAction{\ZIfC{\ZMV}{\EMV_1}{\EMV_2}}{\ZIfC{\ZMV'}{\EMV_1}{\EMV_2}}{\AMV}
  }{AEZipIf1}

  \judgment{
    \AUEAction{\ZMV}{\ZMV'}{\AMV}
  }{
    \AUEAction{\ZIfL{\EMV_1}{\ZMV}{\EMV_2}}{\ZIfL{\EMV_1}{\ZMV'}{\EMV_2}}{\AMV}
  }{AEZipIf2}

  \judgment{
    \AUEAction{\ZMV}{\ZMV'}{\AMV}
  }{
    \AUEAction{\ZIfR{\EMV_1}{\EMV_2}{\ZMV}}{\ZIfR{\EMV_1}{\EMV_2}{\ZMV'}}{\AMV}
  }{AEZipIf3} \\

  \judgment{
    \AUEAction{\ZMV}{\ZMV'}{\AMV}
  }{
    \AUEAction{\ZPairL{\ZMV}{\EMV}}{\ZPairL{\ZMV'}{\EMV}}{\AMV}
  }{AEZipPair1}

  \judgment{
    \AUEAction{\ZMV}{\ZMV'}{\AMV}
  }{
    \AUEAction{\ZPairR{\EMV}{\ZMV}}{\ZPairR{\EMV}{\ZMV'}}{\AMV}
  }{AEZipPair2} \\

  \judgment{
    \AUEAction{\ZMV}{\ZMV'}{\AMV}
  }{
    \AUEAction{\ZProjL{\ZMV}{\EMV}}{\ZProjL{\ZMV'}{\EMV}}{\AMV}
  }{AEZipProjL}

  \judgment{
    \AUEAction{\ZMV}{\ZMV'}{\AMV}
  }{
    \AUEAction{\ZProjR{\EMV}{\ZMV}}{\ZProjR{\EMV}{\ZMV'}}{\AMV}
  }{AEZipProjR}
\end{mathpar}

\subsubsection{Iterated Actions}
\judgbox{\ensuremath{\AUTActionIter{\ZTMV}{\ZTMV'}{\AIMV}}}
%
\begin{mathpar}
  \judgment{ }{
    \AUTActionIter{\ZTMV}{\ZTMV}{\AINil}
  }{ATIRefl}

  \judgment{
    \AUTAction{\ZTMV}{\ZTMV'}{\AMV} \\
    \AUTActionIter{\ZTMV'}{\ZTMV''}{\AIMV}
  }{
    \AUTActionIter{\ZTMV}{\ZTMV''}{\AICons{\AMV}{\AIMV}}
  }{ATIType}
\end{mathpar}

\judgbox{\ensuremath{\AUEActionIter{\ZMV}{\ZMV'}{\AIMV}}}
%
\begin{mathpar}
  \judgment{ }{
    \AUEActionIter{\ZMV}{\ZMV}{\AINil}
  }{AEIRefl}

  \judgment{
    \AUEAction{\ZMV}{\ZMV'}{\AMV} \\
    \AUEActionIter{\ZMV'}{\ZMV''}{\AIMV}
  }{
    \AUEActionIter{\ZMV}{\ZMV''}{\AICons{\AMV}{\AIMV}}
  }{AEIExp}
\end{mathpar}

\judgbox{\ensuremath{\movements{\AIMV}}}
%
\begin{mathpar}
  \judgment{ }{
    \movements{\AINil}
  }{AMINil}

  \judgment{
    \movements{\AIMV}
  }{
    \movements{\AICons{\AMove{\MMV}}{\AIMV}}
  }{AMICons}
\end{mathpar}

\subsubsection{Metatheorems}
\begin{theorem}[name=Sensibility]
\end{theorem}

\begin{theorem}[name=Movement Erasure Invariance] \
  \begin{enumerate}
    \item If $\AUTAction{\ZTMV}{\ZTMV'}{\AMove{\MMV}}$, then $\cursorErase{\ZTMV} =
      \cursorErase{\ZTMV'}$.

    \item If $\AUEAction{\ZMV}{\ZMV'}{\AMove{\MMV}}$, then $\cursorErase{\ZMV} =
      \cursorErase{\ZMV'}$.
  \end{enumerate}
\end{theorem}

\begin{theorem}[name=Reachability] \
  \begin{enumerate}
    \item If $\cursorErase{\ZTMV} = \cursorErase{\ZTMV'}$, then there exists $\AIMV$ such that
      $\movements{\AIMV}$ and $\AUTActionIter{\ZTMV}{\ZTMV'}{\AIMV}$.

    \item If $\cursorErase{\ZMV} = \cursorErase{\ZMV'}$, then there exists $\AIMV$ such that
      $\movements{\AIMV}$ and $\AUEActionIter{\ZMV}{\ZMV'}{\AIMV}$.
  \end{enumerate}
\end{theorem}

\begin{lemma}[name=Reach Up] \
  \begin{enumerate}
    \item If $\cursorErase{\ZTMV} = \TMV$, then there exists $\AIMV$ such that $\movements{\AIMV}$
      and $\AUTActionIter{\ZTMV}{\ZTCursor{\TMV}}{\AIMV}$.

    \item If $\cursorErase{\ZMV} = \EMV$, then there exists $\AIMV$ such that $\movements{\AIMV}$
      and $\AUEActionIter{\ZMV}{\ZTCursor{\EMV}}{\AIMV}$.
  \end{enumerate}
\end{lemma}

\begin{lemma}[name=Reach Down] \
  \begin{enumerate}
    \item If $\cursorErase{\ZTMV} = \TMV$, then there exists $\AIMV$ such that $\movements{\AIMV}$
      and $\AUTActionIter{\ZTCursor{\TMV}}{\ZTMV}{\AIMV}$.

    \item If $\cursorErase{\ZMV} = \EMV$, then there exists $\AIMV$ such that $\movements{\AIMV}$
      and $\AUEActionIter{\ZTCursor{\EMV}}{\ZMV}{\AIMV}$.
  \end{enumerate}
\end{lemma}

\begin{theorem}[name=Constructability] \
  \begin{enumerate}
    \item For every $\TMV$, there exists $\AIMV$ such that
      $\AUTActionIter{\ZTCursor{\TUnknown}}{\ZTCursor{\TMV}}{\AIMV}$.

    \item For every $\EMV$, there exists $\AIMV$ such that
      $\AUEActionIter{\ZCursor{\EEHole}}{\ZCursor{\EMV}}{\AIMV}$.
  \end{enumerate}
\end{theorem}

\begin{theorem}[name=Determinism] \
  \begin{enumerate}
    \item If $\AUTActionIter{\ZTMV}{\ZTMV'}{\AMV}$ and $\AUTActionIter{\ZTMV}{\ZTMV''}{\AMV}$, then
      $\ZTMV' = \ZTMV''$.

    \item If $\AUEActionIter{\ZMV}{\ZMV'}{\AMV}$ and $\AUEActionIter{\ZMV}{\ZMV''}{\AMV}$, then
      $\ZMV' = \ZMV''$.
  \end{enumerate}
\end{theorem}

% \begin{theorem}[name=Actionability] \
  % \begin{enumerate}
    % \item For every $\TMV$ and $\AMV$, there exists $\ZTMV$ such that
      % $\AUTAction{\ZTCursor{\TMV}}{\ZTMV}{\AMV}$.

    % \item For every $\EMV$ and $\AMV$, there exists $\ZMV$ such that
      % $\AUEAction{\ZCursor{\EMV}}{\ZMV}{\AMV}$.
  % \end{enumerate}
% \end{theorem}

\newpage
\section{Typed Hazelnut}

\subsection{Syntax}
Zippered types are the same as in the untyped model.

\[\begin{array}{rrcl}
  \ZMName  & \ZMV  & \Coloneqq & \ZCursor{\ECMV} \mid \ZLamT{x}{\ZTMV}{\ECMV} \mid \ZLamE{x}{\TMV}{\ZMV} \mid \ZApL{\ZMV}{\ECMV} \mid \ZApR{\ECMV}{\ZMV} \\
           &       & \mid         & \ZLetL{x}{\ZMV}{\ECMV} \mid \ZLetR{x}{\ECMV}{\ZMV} \\
           &       & \mid         & \ZPlusL{\ZMV}{\ECMV} \mid \ZPlusR{\ECMV}{\ZMV} \\
           &       & \mid         & \ZIfC{\ZMV}{\ECMV}{\ECMV} \mid \ZIfL{\ECMV}{\ZMV}{\ECMV} \mid \ZIfR{\ECMV}{\ECMV}{\ZMV} \\
           &       & \mid         & \ZInconType{\ZMV} \mid \ZInconBrC{\ZMV}{\ECMV}{\ECMV} \mid \ZInconBrL{\ECMV}{\ZMV}{\ECMV} \mid \ZInconBrR{\ECMV}{\ECMV}{\ZMV} \\
\end{array}\]

\subsubsection{Well-Formedness}
\judgbox{\ensuremath{\zWellFormed{\ZMV}}} $\ZMV$ is well-formed
%
\begin{mathpar}
  \judgment{ }{
    \zWellFormed{\ZCursor{\ECMV}}
  }{WFCursor}

  \judgment{ }{
    \zWellFormed{\ZLamT{x}{\ZTMV}{\ECMV}}
  }{WFLamT}

  \judgment{
    \zWellFormed{\ZMV}
  }{
    \zWellFormed{\ZLamE{x}{\TMV}{\ZMV}}
  }{WFLamE}

  \judgment{
    \zWellFormed{\ZMV}
  }{
    \zWellFormed{\ZApL{\ZMV}{\ECMV}}
  }{WFApL}

  \judgment{
    \zWellFormed{\ZMV}
  }{
    \zWellFormed{\ZApR{\ECMV}{\ZMV}}
  }{WFApR}

  \judgment{
    \zWellFormed{\ZMV}
  }{
    \zWellFormed{\ZLetL{x}{\ZMV}{\ECMV}}
  }{WFLetL}

  \judgment{
    \zWellFormed{\ZMV}
  }{
    \zWellFormed{\ZLetR{x}{\ECMV}{\ZMV}}
  }{WFLetR}

  \judgment{
    \zWellFormed{\ZMV}
  }{
    \zWellFormed{\ZPlusL{\ZMV}{\ECMV}}
  }{WFPlusL}

  \judgment{
    \zWellFormed{\ZMV}
  }{
    \zWellFormed{\ZPlusR{\ECMV}{\ZMV}}
  }{WFPlusR}

  \judgment{
    \zWellFormed{\ZMV}
  }{
    \zWellFormed{\ZIfC{\ZMV}{\ECMV_1}{\ECMV_2}}
  }{WFIfC}

  \judgment{
    \zWellFormed{\ZMV}
  }{
    \zWellFormed{\ZIfL{\ECMV_1}{\ZMV}{\ECMV_2}}
  }{WFIfL}

  \judgment{
    \zWellFormed{\ZMV}
  }{
    \zWellFormed{\ZIfL{\ZMV}{\ECMV_1}{\ECMV_2}}
  }{WFIfC}

  \judgment{
    \zWellFormed{\ZMV}
  }{
    \zWellFormed{\ZInconBrC{\ZMV}{\ECMV_1}{\ECMV_2}}
  }{WFInconsistentBranchesC}

  \judgment{
    \zWellFormed{\ZMV}
  }{
    \zWellFormed{\ZInconBrL{\ECMV_1}{\ZMV}{\ECMV_2}}
  }{WFInconsistentBranchesL}

  \judgment{
    \zWellFormed{\ZMV}
  }{
    \zWellFormed{\ZInconBrL{\ZMV}{\ECMV_1}{\ECMV_2}}
  }{WFInconsistentBranchesR}

  \judgment{
    \notEqual{\ZMV}{\ZCursor{\ECMV}} \\
    \zWellFormed{\ZMV}
  }{
    \zWellFormed{\ZInconType{\ZMV}}
  }{WFInconsistentTypes}
\end{mathpar}

\subsection{Cursor Erasure}
\subsubsection{Type Cursor Erasure}
Type cursor erasure is the same as in the untyped model.

\subsubsection{Expression Cursor Erasure}
\judgbox{\ensuremath{\cursorErase{\ZMV}}} is a metafunction defined as follows:
%
\[\begin{array}{rcl}
  \cursorErasesToRow{\ZCursor{\ECMV}}{\ECMV} \\
  \cursorErasesToRow{(\ZLamT{x}{\ZTMV}{\ECMV})}{\ECLam{x}{\cursorErase{\ZTMV}}{\ECMV}} \\
  \cursorErasesToRow{(\ZLamE{x}{\TMV}{\ZMV})}{\ECLam{x}{\TMV}{\cursorErase{\ZMV}}} \\
  \cursorErasesToRow{(\ZApL{\ZMV}{\ECMV})}{\ECAp{\cursorErase{\ZMV}}{\ECMV}} \\
  \cursorErasesToRow{(\ZApR{\ECMV}{\ZMV})}{\ECAp{\ECMV}{\cursorErase{\ZMV}}} \\
  \cursorErasesToRow{(\ZLetL{x}{\ZMV}{\ECMV})}{\ECLet{x}{\cursorErase{\ZMV}}{\ECMV}} \\
  \cursorErasesToRow{(\ZLetR{x}{\ECMV}{\ZMV})}{\ECLet{x}{\ECMV}{\cursorErase{\ZMV}}} \\
  \cursorErasesToRow{(\ZPlusL{\ZMV}{\ECMV})}{\ECPlus{\cursorErase{\ZMV}}{\ECMV}} \\
  \cursorErasesToRow{(\ZPlusR{\ECMV}{\ZMV})}{\ECPlus{\ECMV}{\cursorErase{\ZMV}}} \\
  \cursorErasesToRow{(\ZIfC{\ZMV}{\ECMV_1}{\ECMV_2})}{\ECIf{\cursorErase{\ZMV}}{\ECMV_1}{\ECMV_2}} \\
  \cursorErasesToRow{(\ZIfL{\ECMV_1}{\ZMV}{\ECMV_2})}{\ECIf{\ECMV_1}{\cursorErase{\ZMV}}{\ECMV_2}} \\
  \cursorErasesToRow{(\ZIfL{\ECMV_1}{\ECMV_2}{\ZMV})}{\ECIf{\ECMV_1}{\ECMV_2}{\cursorErase{\ZMV}}} \\
  \cursorErasesToRow{\ZInconType{\ZMV}}{\cursorErase{\ZMV}} \\
  \cursorErasesToRow{\ZInconBrC{\ZMV}{\ECMV_1}{\ECMV_2}}{\ECIf{\cursorErase{\ZMV}}{\ECMV_1}{\ECMV_2}} \\
  \cursorErasesToRow{\ZInconBrL{\ECMV_1}{\ZMV}{\ECMV_2}}{\ECIf{\ECMV_1}{\cursorErase{\ZMV}}{\ECMV_2}} \\
  \cursorErasesToRow{\ZInconBrR{\ECMV_1}{\ECMV_2}{\ZMV}}{\ECIf{\ECMV_1}{\ECMV_2}{\cursorErase{\ZMV}}} \\
\end{array}\]

\subsection{Action Model}
The action syntax is the same in the untyped model.

\subsubsection{Shape Sort}
The shape sort judgments are the same as in the untyped model.

\subsubsection{Type Actions}
Type actions are the same as in the untyped model.

\subsubsection{Expression Movement}
\judgbox{\ensuremath{\AUEMove{\ZMV}{\ZMV'}{\MMV}}}
%
\begin{mathpar}
  \judgment{ }{
    \ASEMLamChildT{x}{\TMV}{\ECMV}
  }{AEMLamChild1}

  \judgment{ }{
    \ASEMLamChildE{x}{\TMV}{\ECMV}
  }{AEMLamChild2} \\

  \judgment{ }{
    \ASEMLamParentT{x}{\TMV}{\ECMV}
  }{AEMLamParent1}

  \judgment{ }{
    \ASEMLamParentE{x}{\TMV}{\ECMV}
  }{AEMLamParent2}
\end{mathpar}

\begin{mathpar}
  \judgment{ }{
    \ASEMApChildL{\ECMV_1}{\ECMV_2}
  }{AEMApChild1}

  \judgment{ }{
    \ASEMApChildR{\ECMV_1}{\ECMV_2}
  }{AEMApChild2} \\

  \judgment{ }{
    \ASEMApParentL{\ECMV_1}{\ECMV_2}
  }{AEMApParent1}

  \judgment{ }{
    \ASEMApParentR{\ECMV_1}{\ECMV_2}
  }{AEMApParent2}
\end{mathpar}

\begin{mathpar}
  \judgment{ }{
    \ASEMLetChildL{x}{\ECMV_1}{\ECMV_2}
  }{AEMLetChild1}

  \judgment{ }{
    \ASEMLetChildR{x}{\ECMV_1}{\ECMV_2}
  }{AEMLetChild2} \\

  \judgment{ }{
    \ASEMLetParentL{x}{\ECMV_1}{\ECMV_2}
  }{AEMLetParent1}

  \judgment{ }{
    \ASEMLetParentR{x}{\ECMV_1}{\ECMV_2}
  }{AEMLetParent2}
\end{mathpar}

\begin{mathpar}
  \judgment{ }{
    \ASEMPlusChildL{\ECMV_1}{\ECMV_2}
  }{AEMPlusChild1}

  \judgment{ }{
    \ASEMPlusChildR{\ECMV_1}{\ECMV_2}
  }{AEMPlusChild2} \\

  \judgment{ }{
    \ASEMPlusParentL{\ECMV_1}{\ECMV_2}
  }{AEMPlusParent1}

  \judgment{ }{
    \ASEMPlusParentR{\ECMV_1}{\ECMV_2}
  }{AEMPlusParent2}
\end{mathpar}

\begin{mathpar}
  \judgment{ }{
    \ASEMIfChildC{\ECMV_1}{\ECMV_2}{\ECMV_3}
  }{AEMIfChild1}

  \judgment{ }{
    \ASEMIfChildL{\ECMV_1}{\ECMV_2}{\ECMV_3}
  }{AEMIfChild2}

  \judgment{ }{
    \ASEMIfChildR{\ECMV_1}{\ECMV_2}{\ECMV_3}
  }{AEMIfChild3} \\

  \judgment{ }{
    \ASEMIfParentC{\ECMV_1}{\ECMV_2}{\ECMV_3}
  }{AEMIfParent1}

  \judgment{ }{
    \ASEMIfParentL{\ECMV_1}{\ECMV_2}{\ECMV_3}
  }{AEMIfParent2}

  \judgment{ }{
    \ASEMIfParentR{\ECMV_1}{\ECMV_2}{\ECMV_3}
  }{AEMIfParent3}
\end{mathpar}

\begin{mathpar}
  \judgment{
    \ASEMChild{\ZMV}{\ZMV'}{\MChildNMV}
  }{
    \ASEMInconTypeChild{\ZMV}{\ZMV'}{\MChildNMV}
  }{AEMInconsistentTypesChild}

  \judgment{
    \ASEMParent{\ZMV}{\ZMV'}
  }{
    \ASEMInconTypeParent{\ZMV}{\ZMV'}
  }{AEMInconsistentTypesParent}
\end{mathpar}

\begin{mathpar}
  \judgment{ }{
    \ASEMInconBrChildC{\ECMV_1}{\ECMV_2}{\ECMV_3}
  }{AEMInconsistentBranchesChild1}

  \judgment{ }{
    \ASEMInconBrChildL{\ECMV_1}{\ECMV_2}{\ECMV_3}
  }{AEMInconsistentBranchesChild2}

  \judgment{ }{
    \ASEMInconBrChildR{\ECMV_1}{\ECMV_2}{\ECMV_3}
  }{AEMInconsistentBranchesChild3} \\

  \judgment{ }{
    \ASEMInconBrParentC{\ECMV_1}{\ECMV_2}{\ECMV_3}
  }{AEMInconsistentBranchesParent1}

  \judgment{ }{
    \ASEMInconBrParentL{\ECMV_1}{\ECMV_2}{\ECMV_3}
  }{AEMInconsistentBranchesParent2}

  \judgment{ }{
    \ASEMInconBrParentR{\ECMV_1}{\ECMV_2}{\ECMV_3}
  }{AEMInconsistentBranchesParent3}
\end{mathpar}

\subsubsection{Synthetic Expression Actions}
\judgbox{\ensuremath{\ASAction{\ctx}{\ZMV}{\TMV}{\ZMV'}{\TMV'}{\AMV}}}

\paragraph{Movement}
\begin{mathpar}
  \judgment{
    \ASEMove{\ZMV}{\ZMV'}{\MMV}
  }{
    \ASMove{\ctx}{\ZMV}{\TMV}{\ZMV'}{\TMV}{\MMV}
  }{ASEMove}
\end{mathpar}

\paragraph{Deletion}
\begin{mathpar}
  \judgment{ }{
    \ASEDel{\ctx}{\ECMV}{\TMV}
  }{ASEDel}
\end{mathpar}

\paragraph{Construction}
\begin{mathpar}
  \judgment{
    \inCtx{\ctx}{x}{\TMV}
  }{
    \ASEConBoundVar{\ctx}{x}{\TMV}
  }{ASEConVar}

  \judgment{
    \notInCtx{\ctx}{x}
  }{
    \ASEConUnboundVar{\ctx}{x}
  }{ASEConUnbound}
\end{mathpar}

\begin{mathpar}
  \judgment{
    \ctxSynFixedInto{\extendCtx{\ctx}{x}{\TUnknown}}{\erase{\ECMV}}{\ECMV'}{\TMV'}
  }{
    \ASEConLam{\ctx}{\ECMV}{\TMV}{\ECMV'}{\TMV'}{x}
  }{ASEConLam}

  \judgment{
    \matchedArrow{\TMV}{\TMV_1}{\TMV_2}
  }{
    \ASEConApL{\ctx}{\ECMV}{\TMV}{\ECMV}{\TMV_2}
  }{ASEConApL1}

  \judgment{
    \notMatchedArrow{\TMV}
  }{
    \ASEConApL{\ctx}{\ECMV}{\TMV}{\ECInconType{\ECMV}}{\TUnknown}
  }{ASEConApL2}

  \judgment{
  }{
    \ASEConApR{\ctx}{\ECMV}{\TMV}{\ECMV}{\TUnknown}
  }{ASEConApR}
\end{mathpar}

\begin{mathpar}
  \judgment{
  }{
    \ASEConLetL{\ctx}{\ECMV}{\TMV}{\ECMV}{x}
  }{ASEConLet1}

  \judgment{
    \ctxSynFixedInto{\extendCtx{\ctx}{x}{\TUnknown}}{\erase{\ECMV}}{\ECMV'}{\TMV'}
  }{
    \ASEConLetR{\ctx}{\ECMV}{\TMV}{\ECMV'}{\TMV'}{x}
  }{ASEConLet2}
\end{mathpar}

\begin{mathpar}
  \judgment{ }{
    \ASEConNum{\ctx}{\ENumMV}
  }{ASEConNum}

  \judgment{
    \consistent{\TMV}{\TNum}
  }{
    \ASEConPlusL{\ctx}{\ECMV}{\TMV}{\ECMV}
  }{ASEConPlusL1}

  \judgment{
    \inconsistent{\TMV}{\TNum}
  }{
    \ASEConPlusL{\ctx}{\ECMV}{\TMV}{\ECInconType{\ECMV}}
  }{ASEConPlusL2} \\

  \judgment{
    \consistent{\TMV}{\TNum}
  }{
    \ASEConPlusR{\ctx}{\ECMV}{\TMV}{\ECMV}
  }{ASEConPlusR1}

  \judgment{
    \inconsistent{\TMV}{\TNum}
  }{
    \ASEConPlusR{\ctx}{\ECMV}{\TMV}{\ECInconType{\ECMV}}
  }{ASEConPlusR2}
\end{mathpar}

\begin{mathpar}
  \judgment{
    \consistent{\TMV}{\TBool}
  }{
    \ASEConIfC{\ctx}{\ECMV}{\TMV}{\ECMV}
  }{ASEConIfC1}

  \judgment{
    \inconsistent{\TMV}{\TBool}
  }{
    \ASEConIfC{\ctx}{\ECMV}{\TMV}{\ECInconType{\ECMV}}
  }{ASEConIfC2}

  \judgment{ }{
    \ASEConIfL{\ctx}{\ECMV}{\TMV}{\ECMV}{\TMV}
  }{ASEConIfL}

  \judgment{ }{
    \ASEConIfR{\ctx}{\ECMV}{\TMV}{\ECMV}{\TMV}
  }{ASEConIfR}
\end{mathpar}

\paragraph{Zipper Cases}
\begin{mathpar}
  \judgment{
    \AUTAction{\ZTMV_1}{\ZTMV_1'}{\AMV} \\
    \equal{\cursorErase{\ZTMV_1}}{\cursorErase{\ZTMV_1'}}
  }{
    \ASEAction{\ctx}{\ZLamT{x}{\ZTMV_1}{\ECMV}}{\TArrow{\cursorErase{\ZTMV_1}}{\TMV_2}}{\ZLamT{x}{\ZTMV_1'}{\ECMV}}{\TArrow{\cursorErase{\ZTMV_1}}{\TMV_2}}{\AMV}
  }{ASEZipLamT1}

  \judgment{
    \AUTAction{\ZTMV_1}{\ZTMV_1'}{\AMV} \\
    \notEqual{\cursorErase{\ZTMV_1}}{\cursorErase{\ZTMV_1'}} \\
    \ctxSynFixedInto{\extendCtx{\ctx}{x}{\cursorErase{\ZTMV_1'}}}{\erase{\ECMV}}{\ECMV'}{\TMV_2'}
  }{
    \ASEAction{\ctx}{\ZLamT{x}{\ZTMV_1}{\ECMV}}{\TArrow{\cursorErase{\ZTMV_1}}{\TMV_2}}{\ZLamT{x}{\ZTMV_1'}{\ECMV'}}{\TArrow{\cursorErase{\ZTMV_1'}}{\TMV_2'}}{\AMV}
  }{ASEZipLamT2}

  \judgment{
    \ASEAction{\extendCtx{\ctx}{x}{\TMV_1}}{\ZMV}{\TMV_2}{\ZMV'}{\TMV_2'}{\AMV}
  }{
    \ASEAction{\ctx}{\ZLamE{x}{\TMV_1}{\ZMV}}{\TArrow{\TMV_1}{\TMV_2}}{\ZLamE{x}{\TMV_1}{\ZMV'}}{\TArrow{\ZTMV_1}{\TMV_2'}}{\AMV}
  }{ASEZipLamE}
\end{mathpar}

\begin{mathpar}
  \judgment{
    \ctxSynTypeM{\ctx}{\cursorErase{\ZMV_1}}{\TMV_1} \\
    \ASEAction{\ctx}{\ZMV_1}{\TMV_1}{\ZMV_1'}{\TMV_1'}{\AMV} \\\\
    \matchedArrow{\TMV_1'}{\TMV_2}{\TMV_3} \\
    \ctxAnaType{\ctx}{\ECMV_2}{\TMV_2}
  }{
    \ASEAction{\ctx}{\ZApL{\ZMV_1}{\ECMV_2}}{\TMV}{\ZApL{\ZMV_1'}{\ECMV_2}}{\TMV_3}{\AMV}
  }{ASEZipApL1}

  \judgment{
    \ctxSynTypeM{\ctx}{\cursorErase{\ZMV_1}}{\TMV_1} \\
    \ASEAction{\ctx}{\ZMV_1}{\TMV_1}{\ZMV_1'}{\TMV_1'}{\AMV} \\\\
    \matchedArrow{\TMV_1'}{\TMV_2}{\TMV_3} \\
    \ctxNotAnaType{\ctx}{\ECMV_2}{\TMV_2}
  }{
    \ASEAction{\ctx}{\ZApL{\ZMV_1}{\ECMV_2}}{\TMV}{\ZApL{\ZMV_1'}{\ECInconType{\ECMV_2}}}{\TMV_3}{\AMV}
  }{ASEZipApL2}

  \judgment{
    \ctxSynTypeM{\ctx}{\cursorErase{\ZMV_1}}{\TMV_1} \\
    \ASEAction{\ctx}{\ZMV}{\TMV_1}{\ZMV'}{\TMV_1'}{\AMV} \\\\
    \notMatchedArrow{\TMV_1'}
  }{
    \ASEAction{\ctx}{\ZApL{\ZMV_1}{\ECMV_2}}{\TMV}{\ZApL{\ECInconType{\ZMV_1'}}{\ECMV_2}}{\TUnknown}{\AMV}
  }{ASEZipApL3}

  \judgment{
    \ctxSynTypeM{\ctx}{\cursorErase{\ZMV_1}}{\TMV_1} \\
    \ASEAction{\ctx}{\ZMV_1}{\TMV_1}{\ZMV_1'}{\TMV_1'}{\AMV} \\\\
    \matchedArrow{\TMV_1'}{\TMV_2}{\TMV_3} \\
    \ctxAnaType{\ctx}{\ECMV_2}{\TMV_2}
  }{
    \ASEAction{\ctx}{\ZApL{\ECInconType{\ZMV_1}}{\ECMV_2}}{\TUnknown}{\ZApL{\ZMV_1'}{\ECMV_2}}{\TMV_3}{\AMV}
  }{ASEZipApL4}

  \judgment{
    \ctxSynTypeM{\ctx}{\cursorErase{\ZMV_1}}{\TMV_1} \\
    \ASEAction{\ctx}{\ZMV_1}{\TMV_1}{\ZMV_1'}{\TMV_1'}{\AMV} \\\\
    \matchedArrow{\TMV_1'}{\TMV_2}{\TMV_3} \\
    \ctxNotAnaType{\ctx}{\ECMV_2}{\TMV_2}
  }{
    \ASEAction{\ctx}{\ZApL{\ECInconType{\ZMV_1}}{\ECMV_2}}{\TUnknown}{\ZApL{\ZMV_1'}{\ECInconType{\ECMV_2}}}{\TMV_3}{\AMV}
  }{ASEZipApL5}

  \judgment{
    \ctxSynTypeM{\ctx}{\cursorErase{\ZMV_1}}{\TMV_1} \\
    \ASEAction{\ctx}{\ZMV_1}{\TMV_1}{\ZMV_1'}{\TMV_1'}{\AMV} \\\\
    \notMatchedArrow{\TMV_1'}
  }{
    \ASEAction{\ctx}{\ZApL{\ECInconType{\ZMV_1}}{\ECMV_2}}{\TUnknown}{\ZApL{\ECInconType{\ZMV_1'}}{\ECMV_2}}{\TUnknown}{\AMV}
  }{ASEZipApL6}

  \judgment{
    \ctxSynTypeM{\ctx}{\ECMV_1}{\TMV_1} \\
    \matchedArrow{\TMV_1}{\TMV_2}{\TMV_3} \\
    \AAEAction{\ctx}{\ZMV_2}{\ZMV_2'}{\TMV_2}{\AMV}
  }{
    \ASEAction{\ctx}{\ZApR{\ECMV_1}{\ZMV_2}}{\TMV}{\ZApR{\ECMV_1}{\ZMV_2'}}{\TMV_3}{\AMV}
  }{ASEZipApR}
\end{mathpar}

\begin{mathpar}
  \judgment{
    \ctxSynTypeM{\ctx}{\cursorErase{\ZMV_1}}{\TMV_1} \\
    \ASEAction{\ctx}{\ZMV_1}{\TMV_1}{\ZMV_1'}{\TMV_1'}{\AMV} \\
    \consistent{\TMV_1}{\TMV_1'}
  }{
    \ASEAction{\ctx}{\ZLetL{x}{\ZMV_1}{\ECMV_2}}{\TMV_2}{\ZLetL{x}{\ZMV_1'}{\ECMV_2}}{\TMV_2}{\AMV}
  }{ASEZipLetL1}

  \judgment{
    \ctxSynTypeM{\ctx}{\cursorErase{\ZMV_1}}{\TMV_1} \\
    \ASEAction{\ctx}{\ZMV_1}{\TMV_1}{\ZMV_1'}{\TMV_1'}{\AMV} \\\\
    \inconsistent{\TMV_1}{\TMV_1'} \\
    \ctxSynFixedInto{\extendCtx{\ctx}{x}{\TMV_1'}}{\erase{\ECMV_2}}{\ECMV_2'}{\TMV_2'}
  }{
    \ASEAction{\ctx}{\ZLetL{x}{\ZMV_1}{\ECMV_2}}{\TMV_2}{\ZLetL{x}{\ZMV_1'}{\ECMV_2'}}{\TMV_2'}{\AMV}
  }{ASEZipLetL2}

  \judgment{
    \ctxSynTypeM{\ctx}{\ECMV_1}{\TMV_1} \\
    \ctxSynTypeM{\extendCtx{\ctx}{x}{\TMV_1}}{\cursorErase{\ZMV_2}}{\TMV_2} \\\\
    \ASEAction{\extendCtx{\ctx}{x}{\TMV_1}}{\ZMV_2}{\TMV_2}{\ZMV_2'}{\TMV_2'}{\AMV}
  }{
    \ASEAction{\ctx}{\ZLetR{x}{\ECMV_1}{\ZMV_2}}{\TMV_2}{\ZLetR{x}{\ECMV_1}{\ZMV_2'}}{\TMV_2'}{\AMV}
  }{ASEZipLetR}
\end{mathpar}

\begin{mathpar}
  \judgment{
    \AAEAction{\ctx}{\ZMV}{\ZMV'}{\TNum}{\AMV}
  }{
    \ASEAction{\ctx}{\ZPlusL{\ZMV}{\ECMV}}{\TNum}{\ZPlusL{\ZMV'}{\ECMV}}{\TNum}{\AMV}
  }{ASEZipPlusL}

  \judgment{
    \AAEAction{\ctx}{\ZMV}{\ZMV'}{\TNum}{\AMV}
  }{
    \ASEAction{\ctx}{\ZPlusR{\ECMV}{\ZMV}}{\TNum}{\ZPlusR{\ECMV}{\ZMV'}}{\TNum}{\AMV}
  }{ASEZipPlusR}
\end{mathpar}

\begin{mathpar}
  \judgment{
    \AAEAction{\ctx}{\ZMV}{\ZMV'}{\TBool}{\AMV}
  }{
    \ASEAction{\ctx}{\ZIfC{\ZMV}{\ECMV_1}{\ECMV_2}}{\TMV}{\ZIfC{\ZMV'}{\ECMV_1}{\ECMV_2}}{\TMV}{\AMV}
  }{ASEZipIfC}

  \judgment{
    \ctxSynTypeM{\ctx}{\cursorErase{\ZMV}}{\TMV_1} \\
    \ctxSynTypeM{\ctx}{\ECMV_2}{\TMV_2} \\\\
    \ASEAction{\ctx}{\ZMV}{\TMV_1}{\ZMV'}{\TMV_1'}{\AMV} \\
    \consistent{\TMV_1'}{\TMV_2}
  }{
    \ASEAction{\ctx}{\ZIfL{\ECMV_1}{\ZMV}{\ECMV_2}}{\TMV}{\ZIfL{\ECMV_1}{\ZMV'}{\ECMV_2}}{\TJoin{\TMV_1'}{\TMV_2}}{\AMV}
  }{ASEZipIfL1}

  \judgment{
    \ctxSynTypeM{\ctx}{\cursorErase{\ZMV}}{\TMV_1} \\
    \ctxSynTypeM{\ctx}{\ECMV_2}{\TMV_2} \\\\
    \ASEAction{\ctx}{\ZMV}{\TMV_1}{\ZMV'}{\TMV_1'}{\AMV} \\
    \inconsistent{\TMV_1'}{\TMV_2}
  }{
    \ASEAction{\ctx}{\ZIfL{\ECMV_1}{\ZMV}{\ECMV_2}}{\TMV}{\ZInconBrL{\ECMV_1}{\ZMV'}{\ECMV_2}}{\TUnknown}{\AMV}
  }{ASEZipIfL2}

  \judgment{
    \ctxSynTypeM{\ctx}{\ECMV_2}{\TMV_1} \\
    \ctxSynTypeM{\ctx}{\cursorErase{\ZMV}}{\TMV_2} \\\\
    \ASEAction{\ctx}{\ZMV}{\TMV_2}{\ZMV'}{\TMV_2'}{\AMV} \\
    \consistent{\TMV_1}{\TMV_2'}
  }{
    \ASEAction{\ctx}{\ZIfR{\ECMV_1}{\ECMV_2}{\ZMV}}{\TMV}{\ZIfR{\ECMV_1}{\ECMV_2}{\ZMV'}}{\TJoin{\TMV_1}{\TMV_2'}}{\AMV}
  }{ASEZipIfR1}

  \judgment{
    \ctxSynTypeM{\ctx}{\ECMV_1}{\TMV_1} \\
    \ctxSynTypeM{\ctx}{\cursorErase{\ZMV}}{\TMV_2} \\\\
    \ASEAction{\ctx}{\ZMV}{\TMV_2}{\ZMV'}{\TMV_2'}{\AMV} \\
    \inconsistent{\TMV_1}{\TMV_2'}
  }{
    \ASEAction{\ctx}{\ZIfR{\ECMV_1}{\ECMV_2}{\ZMV}}{\TMV}{\ZInconBrR{\ECMV_1}{\ECMV_2}{\ZMV'}}{\TUnknown}{\AMV}
  }{ASEZipIfR2}
\end{mathpar}

\begin{mathpar}
  \judgment{
    \AAEAction{\ctx}{\ZMV}{\ZMV'}{\TBool}{\AMV}
  }{
    \ASEAction{\ctx}{\ZInconBrC{\ZMV}{\ECMV_1}{\ECMV_2}}{\TMV}{\ZInconBrC{\ZMV'}{\ECMV_1}{\ECMV_2}}{\TMV}{\AMV}
  }{ASEZipInconsistentBranchesC}

  \judgment{
    \ASEAction{\ctx}{\ZMV}{\TMV_1}{\ZMV'}{\TMV_1'}{\AMV} \\
    \ctxSynTypeM{\ctx}{\ECMV_2}{\TMV_2} \\
    \consistent{\TMV_1'}{\TMV_2}
  }{
    \ASEAction{\ctx}{\ZInconBrL{\ECMV_1}{\ZMV}{\ECMV_2}}{\TMV}{\ZIfL{\ECMV_1}{\ZMV'}{\ECMV_2}}{\TJoin{\TMV_1'}{\TMV_2}}{\AMV}
  }{ASEZipInconsistentBranchesL1}

  \judgment{
    \ASEAction{\ctx}{\ZMV}{\TMV_1}{\ZMV'}{\TMV_1'}{\AMV} \\
    \ctxSynTypeM{\ctx}{\ECMV_2}{\TMV_2} \\
    \inconsistent{\TMV_1'}{\TMV_2}
  }{
    \ASEAction{\ctx}{\ZInconBrL{\ECMV_1}{\ZMV}{\ECMV_2}}{\TMV}{\ZInconBrL{\ECMV_1}{\ZMV'}{\ECMV_2}}{\TUnknown}{\AMV}
  }{ASEZipInconsistentBranchesL2}

  \judgment{
    \ctxSynTypeM{\ctx}{\ECMV_1}{\TMV_1} \\
    \ASEAction{\ctx}{\ZMV}{\TMV_2}{\ZMV'}{\TMV_2'}{\AMV} \\
    \consistent{\TMV_1}{\TMV_2'}
  }{
    \ASEAction{\ctx}{\ZInconBrR{\ECMV_1}{\ECMV_2}{\ZMV}}{\TMV}{\ZIfL{\ECMV_1}{\ECMV_2}{\ZMV'}}{\TJoin{\TMV_1}{\TMV_2'}}{\AMV}
  }{ASEZipInconsistentBranchesR1}

  \judgment{
    \ctxSynTypeM{\ctx}{\ECMV_2}{\TMV_1} \\
    \ASEAction{\ctx}{\ZMV}{\TMV_2}{\ZMV'}{\TMV_2'}{\AMV} \\
    \inconsistent{\TMV_1}{\TMV_2'}
  }{
    \ASEAction{\ctx}{\ZInconBrR{\ECMV_1}{\ECMV_2}{\ZMV}}{\TMV}{\ZInconBrR{\ECMV_1}{\ECMV_2}{\ZMV'}}{\TUnknown}{\AMV}
  }{ASEZipInconsistentBranchesR2}
\end{mathpar}

\subsubsection{Analytic Expression Actions}
\judgbox{\ensuremath{\AAAction{\ctx}{\ZMV}{\ZMV'}{\TMV'}{\AMV}}}

\paragraph{Subsumption}
\begin{mathpar}
  \judgment{
    \ctxSynTypeM{\ctx}{\cursorErase{\ZMV}}{\TMV'} \\
    \ASAction{\ctx}{\ZMV}{\TMV'}{\ZMV'}{\TMV''}{\AMV} \\\\
    \consistent{\TMV}{\TMV''} \\
    \subsumable{\cursorErase{\ZMV}}
  }{
    \AAAction{\ctx}{\ZMV}{\ZMV'}{\TMV}{\AMV}
  }{AAESubsume1}

  \judgment{
    \ctxSynTypeM{\ctx}{\cursorErase{\ZMV}}{\TMV'} \\
    \ASAction{\ctx}{\ZMV}{\TMV'}{\ZMV'}{\TMV''}{\AMV} \\\\
    \inconsistent{\TMV}{\TMV''} \\
    \subsumable{\cursorErase{\ZMV}}
  }{
    \AAAction{\ctx}{\ZMV}{\ZInconType{\ZMV'}}{\TMV}{\AMV}
  }{AAESubsume2}

  \judgment{
    \ctxSynTypeM{\ctx}{\cursorErase{\ZMV}}{\TMV'} \\
    \ASAction{\ctx}{\ZMV}{\TMV'}{\ZMV'}{\TMV''}{\AMV} \\\\
    \inconsistent{\TMV}{\TMV''} \\
    \subsumable{\cursorErase{\ZMV}}
  }{
    \AAAction{\ctx}{\ZInconType{\ZMV}}{\ZInconType{\ZMV'}}{\TMV}{\AMV}
  }{AAEInconsistentTypes1}

  \judgment{
    \ctxSynTypeM{\ctx}{\cursorErase{\ZMV}}{\TMV'} \\
    \ASAction{\ctx}{\ZMV}{\TMV'}{\ZMV'}{\TMV''}{\AMV} \\\\
    \consistent{\TMV}{\TMV''} \\
    \subsumable{\cursorErase{\ZMV}}
  }{
    \AAAction{\ctx}{\ZInconType{\ZMV}}{\ZMV'}{\TMV}{\AMV}
  }{AAEInconsistentTypes2}
\end{mathpar}

\paragraph{Movement}
\begin{mathpar}
  \judgment{
    \ASEMove{\ZMV}{\ZMV'}{\MMV}
  }{
    \AAMove{\ctx}{\ZMV}{\ZMV'}{\TMV}{\MMV}
  }{AAEMove}
\end{mathpar}

\paragraph{Deletion}
\begin{mathpar}
  \judgment{ }{
    \AAEDel{\ctx}{\ECMV}{\TMV}
  }{AAEDel}
\end{mathpar}

\paragraph{Construction}
\begin{mathpar}
  \judgment{
    \matchedArrow{\TMV}{\TMV_1}{\TMV_2} \\
    \ctxAnaFixedInto{\extendCtx{\ctx}{x}{\TMV_1}}{\ECMV}{\ECMV'}{\TMV_2}
  }{
    \AACon{\ctx}{\ZCursor{\ECMV}}{\ZLamT{x}{\ZTCursor{\TMV_1}}{\ECMV'}}{\TMV}{\SLam{x}}
  }{AAEConLam1}

  \judgment{
    \notMatchedArrow{\TMV} \\
    \ctxAnaFixedInto{\extendCtx{\ctx}{x}{\TUnknown}}{\ECMV}{\ECMV'}{\TUnknown}
  }{
    \AACon{\ctx}{\ZCursor{\ECMV}}{\ZInconType{\ZLamT{x}{\ZTCursor{\TUnknown}}{\ECMV'}}}{\TMV}{\SLam{x}}
  }{AAEConLam2}
\end{mathpar}

\begin{mathpar}
  \judgment{
  }{
    \AACon{\ctx}{\ZCursor{\ECMV}}{\ZLetL{x}{\ECMV}{\ZCursor{\ECEHole}}}{\TMV}{\SLetL{x}}
  }{AAEConLetL}

  \judgment{
    \ctxAnaFixedInto{\extendCtx{\ctx}{x}{\TUnknown}}{\erase{\ECMV}}{\ECMV'}{\TMV}
  }{
    \AACon{\ctx}{\ZCursor{\ECMV}}{\ZLetR{x}{\ZCursor{\ECEHole}}{\ECMV'}}{\TMV}{\SLetR{x}}
  }{AAEConLetR}
\end{mathpar}
 
\begin{mathpar}
  \judgment{ }{
    \AACon{\ctx}{\ZCursor{\ECMV}}{\ZIfC{\ZCursor{\ECEHole}}{\ECMV}{\ECEHole}}{\TMV}{\SIfL}
  }{AAEConIfL}

  \judgment{
  }{
    \AACon{\ctx}{\ZCursor{\ECMV}}{\ZIfC{\ZCursor{\ECEHole}}{\ECEHole}{\ECMV}}{\TMV}{\SIfR}
  }{AAEConIfR}
\end{mathpar}

\paragraph{Zipper Cases}
\begin{mathpar}
  \judgment{
    \AUTAction{\ZTMV}{\ZTMV'}{\AMV} \\
    \consistent{\cursorErase{\ZTMV}}{\cursorErase{\ZTMV'}}
  }{
    \AAAction{\ctx}{\ZLamT{x}{\ZTMV}{\ECMV}}{\ZLamT{x}{\ZTMV'}{\ECMV}}{\TMV}{\AMV}
  }{AAEZipLamT1}

  \judgment{
    \AUTAction{\ZTMV}{\ZTMV'}{\AMV} \\
    \inconsistent{\cursorErase{\ZTMV}}{\cursorErase{\ZTMV'}} \\
    \matchedArrow{\TMV}{\TMV_1}{\TMV_2} \\\\
    \consistent{\cursorErase{\ZTMV'}}{\TMV_1} \\
    \ctxAnaFixedInto{\extendCtx{\ctx}{x}{\cursorErase{\ZTMV'}}}{\erase{\ECMV}}{\ECMV'}{\TMV_2}
  }{
    \AAAction{\ctx}{\ZLamT{x}{\ZTMV}{\ECMV}}{\ZLamT{x}{\ZTMV'}{\ECMV'}}{\TMV}{\AMV}
  }{AAEZipLamT2}

  \judgment{
    \AUTAction{\ZTMV}{\ZTMV'}{\AMV} \\
    \inconsistent{\cursorErase{\ZTMV}}{\cursorErase{\ZTMV'}} \\
    \matchedArrow{\TMV}{\TMV_1}{\TMV_2} \\\\
    \inconsistent{\cursorErase{\ZTMV'}}{\TMV_1} \\
    \ctxAnaFixedInto{\extendCtx{\ctx}{x}{\TMV_1}}{\erase{\ECMV}}{\ECMV'}{\TMV_2}
  }{
    \AAAction{\ctx}{\ZLamT{x}{\ZTMV}{\ECMV}}{\ZInconType{\ZLamT{x}{\ZTMV'}{\ECMV'}}}{\TMV}{\AMV}
  }{AAEZipLamT3}

  \judgment{
    \matchedArrow{\TMV}{\TMV_1}{\TMV_2} \\
    \AAAction{\extendCtx{\ctx}{x}{\TMV_3}}{\ZMV}{\ZMV'}{\TMV_2}{\AMV}
  }{
    \AAAction{\ctx}{\ZLamE{x}{\TMV_3}{\ZMV}}{\ZLamE{x}{\TMV_3}{\ZMV'}}{\TMV}{\AMV}
  }{AAEZipLamE}
\end{mathpar}

\begin{mathpar}
  \judgment{
    \ctxSynTypeM{\ctx}{\cursorErase{\ZMV}}{\TMV_1} \\
    \ASEAction{\ctx}{\ZMV}{\TMV_1}{\ZMV'}{\TMV_1'}{\AMV} \\
    \consistent{\TMV_1}{\TMV_1'}
  }{
    \AAAction{\ctx}{\ZLetL{x}{\ZMV}{\ECMV}}{\ZLetL{x}{\ZMV'}{\ECMV}}{\TMV}{\AMV}
  }{AAEZipLetL1}

  \judgment{
    \ctxSynTypeM{\ctx}{\cursorErase{\ZMV}}{\TMV_1} \\
    \ASEAction{\ctx}{\ZMV}{\TMV_1}{\ZMV'}{\TMV_1'}{\AMV} \\\\
    \ctxAnaFixedInto{\extendCtx{\ctx}{x}{\TMV_1'}}{\erase{\ECMV}}{\ECMV'}{\TMV}
  }{
    \AAAction{\ctx}{\ZLetL{x}{\ZMV}{\ECMV}}{\ZLetL{x}{\ZMV'}{\ECMV'}}{\TMV}{\AMV}
  }{AAEZipLetL2}

  \judgment{
    \ctxSynTypeM{\ctx}{\ECMV}{\TMV'} \\
    \AAAction{\extendCtx{\ctx}{x}{\TMV'}}{\ZMV}{\ZMV'}{\TMV}{\AMV}
  }{
    \AAAction{\ctx}{\ZLetR{x}{\ECMV}{\ZMV}}{\ZLetL{x}{\ECMV}{\ZMV'}}{\TMV}{\AMV}
  }{AAEZipLetR}
\end{mathpar}

\begin{mathpar}
  \judgment{
    \AAAction{\ctx}{\ZMV}{\ZMV'}{\TBool}{\AMV}
  }{
    \AAAction{\ctx}{\ZIfC{\ZMV}{\ECMV_1}{\ECMV_2}}{\ZIfC{\ZMV'}{\ECMV_1}{\ECMV_2}}{\TMV}{\AMV}
  }{AAEZipIfC}

  \judgment{
    \AAAction{\ctx}{\ZMV}{\ZMV'}{\TMV}{\AMV}
  }{
    \AAAction{\ctx}{\ZIfL{\ECMV_1}{\ZMV}{\ECMV_2}}{\ZIfL{\ECMV_1}{\ZMV'}{\ECMV_2}}{\TMV}{\AMV}
  }{AAEZipIfL}

  \judgment{
    \AAAction{\ctx}{\ZMV}{\ZMV'}{\TMV}{\AMV}
  }{
    \AAAction{\ctx}{\ZIfR{\ECMV_1}{\ECMV_2}{\ZMV}}{\ZIfR{\ECMV_1}{\ECMV_2}{\ZMV'}}{\TMV}{\AMV}
  }{AAEZipIfR}
\end{mathpar}

\subsubsection{Iterated Actions}
The iterated type action and movements judgments are the same as in the untyped model. \\

\judgbox{\ensuremath{\ASEActionIter{\ctx}{\ZMV}{\TMV}{\ZMV'}{\TMV'}{\AIMV}}}
%
\begin{mathpar}
  \judgment{ }{
    \ASEActionIter{\ctx}{\ZMV}{\TMV}{\ZMV}{\TMV}{\AINil}
  }{ASEIRefl}

  \judgment{
    \ASEAction{\ctx}{\ZMV}{\TMV}{\ZMV'}{\TMV'}{\AMV} \\
    \ASEActionIter{\ctx}{\ZMV'}{\TMV'}{\ZMV''}{\TMV''}{\AIMV}
  }{
    \ASEActionIter{\ctx}{\ZMV}{\TMV}{\ZMV''}{\TMV''}{\AICons{\AMV}{\AIMV}}
  }{ASEIExp}
\end{mathpar}

\judgbox{\ensuremath{\AAEActionIter{\ctx}{\ZMV}{\ZMV'}{\TMV}{\AIMV}}}
%
\begin{mathpar}
  \judgment{ }{
    \AAEActionIter{\ctx}{\ZMV}{\ZMV}{\TMV}{\AINil}
  }{AAEIRefl}

  \judgment{
    \AAEAction{\ctx}{\ZMV}{\ZMV'}{\TMV'}{\AMV} \\
    \AAEActionIter{\ctx}{\ZMV'}{\ZMV''}{\TMV''}{\AIMV}
  }{
    \AAEActionIter{\ctx}{\ZMV}{\ZMV''}{\TMV''}{\AICons{\AMV}{\AIMV}}
  }{AAEIExp}
\end{mathpar}

\subsubsection{Metatheorems}
\begin{theorem}[name=Sensibility] \
  \begin{enumerate}
    \item If $\zWellFormed{\ZMV}$ and $\ctxSynTypeM{\ctx}{\cursorErase{\ZMV}}{\TMV}$ and
      $\ASEAction{\ctx}{\ZMV}{\TMV}{\ZMV'}{\TMV'}{\AMV}$, then $\zWellFormed{\ZMV'}$ and
      $\ctxSynTypeM{\ctx}{\cursorErase{\ZMV'}}{\TMV'}$.

    \item If $\zWellFormed{\ZMV}$ and $\ctxAnaType{\ctx}{\cursorErase{\ZMV}}{\TMV}$ and
      $\AAEAction{\ctx}{\ZMV}{\ZMV'}{\TMV}{\AMV}$, then $\zWellFormed{\ZMV'}$ and
      $\ctxAnaType{\ctx}{\cursorErase{\ZMV'}}{\TMV}$.
  \end{enumerate}
\end{theorem}

\begin{theorem}[name=Movement Erasure Invariance] \
  \begin{enumerate}
    \item If $\AUTAction{\ZTMV}{\ZTMV'}{\AMove{\MMV}}$, then $\cursorErase{\ZTMV} =
      \cursorErase{\ZTMV'}$.

    \item If $\zWellFormed{\ZMV}$ and $\ctxSynTypeM{\ctx}{\cursorErase{\ZMV}}{\TMV}$ and
      $\ASEAction{\ctx}{\ZMV}{\TMV}{\ZMV'}{\TMV'}{\AMove{\MMV}}$, then $\zWellFormed{\ZMV'}$ and
      $\cursorErase{\ZMV} = \cursorErase{\ZMV'}$ and $\equal{\TMV}{\TMV'}$.

    \item If $\zWellFormed{\ZMV}$ and $\ctxAnaType{\ctx}{\cursorErase{\ZMV}}{\TMV}$ and
      $\AAEAction{\ctx}{\ZMV}{\ZMV'}{\TMV}{\AMove{\MMV}}$, then $\zWellFormed{\ZMV'}$ and
      $\cursorErase{\ZMV} = \cursorErase{\ZMV'}$.
  \end{enumerate}
\end{theorem}

\begin{theorem}[name=Reachability] \
  \begin{enumerate}
    \item If $\cursorErase{\ZTMV} = \cursorErase{\ZTMV'}$, then there exists $\AIMV$ such that
      $\movements{\AIMV}$ and $\AUTActionIter{\ZTMV}{\ZTMV'}{\AIMV}$.

    \item If $\zWellFormed{\ZMV}$ and $\zWellFormed{\ZMV'}$ and
      $\ctxSynTypeM{\ctx}{\cursorErase{\ZMV}}{\TMV}$ and $\cursorErase{\ZMV} = \cursorErase{\ZMV'}$,
      then there exists $\AIMV$ such that $\movements{\AIMV}$ and
      $\ASEActionIter{\ctx}{\ZMV}{\TMV}{\ZMV'}{\TMV}{\AIMV}$.

    \item If $\zWellFormed{\ZMV}$ and $\zWellFormed{\ZMV'}$ and
      $\ctxAnaType{\ctx}{\cursorErase{\ZMV}}{\TMV}$ and $\cursorErase{\ZMV} = \cursorErase{\ZMV'}$,
      then there exists $\AIMV$ such that $\movements{\AIMV}$ and
      $\AAEActionIter{\ctx}{\ZMV}{\ZMV'}{\TMV}{\AIMV}$.
  \end{enumerate}
\end{theorem}

\begin{lemma}[name=Reach Up] \
  \begin{enumerate}
    \item If $\cursorErase{\ZTMV} = \TMV$, then there exists $\AIMV$ such that $\movements{\AIMV}$
      and $\AUTActionIter{\ZTMV}{\ZTCursor{\TMV}}{\AIMV}$.

    \item If $\zWellFormed{\ZMV}$ and $\ctxSynTypeM{\ctx}{\cursorErase{\ZMV}}{\TMV}$ and
      $\cursorErase{\ZMV} = \ECMV$, then there exists $\AIMV$ such that $\movements{\AIMV}$ and
      $\ASEActionIter{\ctx}{\ZMV}{\TMV}{\ZTCursor{\ECMV}}{\TMV}{\AIMV}$.

    \item If $\zWellFormed{\ZMV}$ and $\ctxAnaType{\ctx}{\cursorErase{\ZMV}}{\TMV}$ and
      $\cursorErase{\ZMV} = \ECMV$, then there exists $\AIMV$ such that $\movements{\AIMV}$ and
      $\AAEActionIter{\ctx}{\ZMV}{\ZTCursor{\ECMV}}{\TMV}{\AIMV}$.
  \end{enumerate}
\end{lemma}

\begin{lemma}[name=Reach Down] \
  \begin{enumerate}
    \item If $\cursorErase{\ZTMV} = \TMV$, then there exists $\AIMV$ such that $\movements{\AIMV}$
      and $\AUTActionIter{\ZTCursor{\TMV}}{\ZTMV}{\AIMV}$.

    \item If $\zWellFormed{\ZMV}$ and $\ctxSynTypeM{\ctx}{\cursorErase{\ZMV}}{\TMV}$ and
      $\cursorErase{\ZMV} = \ECMV$, then there exists $\AIMV$ such that $\movements{\AIMV}$ and
      $\ASEActionIter{\ctx}{\ZTCursor{\ECMV}}{\TMV}{\ZMV}{\TMV}{\AIMV}$.

    \item If $\zWellFormed{\ZMV}$ and $\ctxAnaType{\ctx}{\cursorErase{\ZMV}}{\TMV}$ and
      $\cursorErase{\ZMV} = \ECMV$, then there exists $\AIMV$ such that $\movements{\AIMV}$ and
      $\AAEActionIter{\ctx}{\ZTCursor{\ECMV}}{\ZMV}{\TMV}{\AIMV}$.
  \end{enumerate}
\end{lemma}

\begin{theorem}[name=Constructability] \
  \begin{enumerate}
    \item For every $\TMV$, there exists $\AIMV$ such that
      $\AUTActionIter{\ZTCursor{\TUnknown}}{\ZTCursor{\TMV}}{\AIMV}$.

    \item If $\ctxSynTypeM{\ctx}{\ECMV}{\TMV}$, then there exists $\AIMV$ such that
      $\ASEActionIter{\ctx}{\ZCursor{\EEHole}}{\TUnknown}{\ZCursor{\ECMV}}{\TMV}{\AIMV}$.

    \item If $\ctxAnaType{\ctx}{\ECMV}{\TMV}$, then there exists $\AIMV$ such that
      $\AAEActionIter{\ctx}{\ZCursor{\EEHole}}{\ZCursor{\ECMV}}{\TMV}{\AIMV}$.
  \end{enumerate}
\end{theorem}

\begin{theorem}[name=Determinism] \
  \begin{enumerate}
    \item If $\AUTActionIter{\ZTMV}{\ZTMV'}{\AMV}$ and $\AUTActionIter{\ZTMV}{\ZTMV''}{\AMV}$, then
      $\ZTMV' = \ZTMV''$.

    \item If $\zWellFormed{\ZMV}$ and $\ctxSynTypeM{\ctx}{\cursorErase{\ZMV}}{\TMV}$ and
      $\ASEActionIter{\ctx}{\ZMV}{\TMV}{\ZMV'}{\TMV'}{\AMV}$ and
      $\ASEActionIter{\ctx}{\ZMV}{\TMV}{\ZMV''}{\TMV''}{\AMV}$, then $\ZMV' = \ZMV''$ and
      $\equal{\TMV'}{\TMV''}$.

    \item If $\zWellFormed{\ZMV}$ and $\ctxAnaType{\ctx}{\cursorErase{\ZMV}}{\TMV}$ and
      $\AAEActionIter{\ctx}{\ZMV}{\ZMV'}{\TMV}{\AMV}$ and
      $\AAEActionIter{\ctx}{\ZMV}{\ZMV''}{\TMV}{\AMV}$, then $\ZMV' = \ZMV''$.
  \end{enumerate}
\end{theorem}

\end{document}
