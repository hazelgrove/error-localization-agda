%
% utilities
%
\definecolor{hole}{RGB}{162,85,162}
\definecolor{cursorhighlight}{RGB}{230,255,230}
\definecolor{cursor}{RGB}{76,170,76}
\newcommand{\mathcolorbox}[2]{\colorbox{#1}{$\displaystyle #2$}}

%
% judgments
%

% judgments
\newcommand{\judgment}[3]{\inferrule{#1}{#2}~~{\textsc{\small [#3]}}}
\newcommand{\judgbox}[1]{\noindent \fbox{$#1$}}

% consistency
\newcommand{\consistent}[2]{\ensuremath{#1 \sim #2}}
\newcommand{\inconsistentRel}{\ensuremath{\nsim}}
\newcommand{\inconsistent}[2]{\ensuremath{#1 \inconsistentRel #2}}

% matching
\newcommand{\matchedRel}[1]{\ensuremath{\blacktriangleright_{#1}}}
\newcommand{\notMatchedRel}[1]{\ensuremath{\blacktriangleright_{\centernot#1}}}
\newcommand{\matchedArrowRel}{\ensuremath{\matchedRel{\to}}}
\newcommand{\notMatchedArrowRel}{\ensuremath{\notMatchedRel{\to}}}
\newcommand{\matchedArrow}[3]{\ensuremath{#1 \matchedArrowRel \TArrow{#2}{#3}}}
\newcommand{\notMatchedArrow}[3]{\ensuremath{#1 \notMatchedArrowRel \TArrow{#2}{#3}}}
\newcommand{\matchedPairRel}{\ensuremath{\matchedRel{\times}}}
\newcommand{\notMatchedPairRel}{\ensuremath{\notMatchedRel{\times}}}
\newcommand{\matchedPair}[3]{\ensuremath{#1 \matchedPairRel \TPair{#2}{#3}}}
\newcommand{\notMatchedPair}[3]{\ensuremath{#1 \notMatchedPairRel \TPair{#2}{#3}}}

% contexts
\newcommand{\ctx}{\ensuremath{\Gamma}}
\newcommand{\extendCtx}[3]{\ensuremath{#1 ; ~\assignType{#2}{#3}}}
\DeclareMathOperator{\dom}{dom}
\newcommand{\inCtx}[3]{\ensuremath{#2, #3 \in #1}}
\newcommand{\notInCtx}[2]{\ensuremath{#2 \not\in \dom(#1)}}
\newcommand{\withCtx}[2]{\ensuremath{#1 \vdash #2}}

% typing
\newcommand{\assignType}[2]{\ensuremath{#1 : #2}}
\newcommand{\ctxAssignType}[3]{\ensuremath{\withCtx{#1}{\assignType{#2}{#3}}}}
\newcommand{\synType}[2]{\ensuremath{#1 \Rightarrow #2}}
\newcommand{\ctxSynType}[3]{\ensuremath{\withCtx{#1}{\synType{#2}{#3}}}}
\newcommand{\anaType}[2]{\ensuremath{#1 \Leftarrow #2}}
\newcommand{\ctxAnaType}[3]{\ensuremath{\withCtx{#1}{\anaType{#2}{#3}}}}

% subsumable
\newcommand{\subsumable}[1]{\ensuremath{#1 ~\textsf{subsumable}}}

% mark erasure
\newcommand{\erase}[1]{\ensuremath{#1^{\square}}}
\newcommand{\erasesTo}[2]{\ensuremath{#1^{\square} = #2}}

% marking
\newcommand{\synFixedInto}[3]{\ensuremath{\synType{#1 \looparrowright #2}{#3}}}
\newcommand{\ctxSynFixedInto}[4]{\ensuremath{\withCtx{#1}{\synFixedInto{#2}{#3}{#4}}}}
\newcommand{\anaFixedInto}[3]{\ensuremath{\anaType{#1 \looparrowright #2}{#3}}}
\newcommand{\ctxAnaFixedInto}[4]{\ensuremath{\withCtx{#1}{\anaFixedInto{#2}{#3}{#4}}}}

% marking image
\newcommand{\image}[1]{\ensuremath{#1^{\circ}}}
\newcommand{\imageIs}[2]{\ensuremath{\image{#1} = #2}}
\newcommand{\imageIsNot}[2]{\ensuremath{\image{#1} \neq #2}}

% cursor erasure
\newcommand{\cursorErase}[1]{\ensuremath{#1^{\diamond}}}
\newcommand{\cursorErasesTo}[2]{\ensuremath{#1^{\diamond} = #2}}

% 
% types
%
\newcommand{\TMName}{\textsf{Type}}
\newcommand{\TMSet}{\ensuremath{T}}
\newcommand{\TMV}{\ensuremath{\tau}}

\newcommand{\joinRel}{\sqcup}
\newcommand{\noJoinRel}{\centernot\sqcup}
\newcommand{\TJoin}[2]{\ensuremath{#1 \joinRel #2}}

\DeclareMathOperator{\?}{?}
\newcommand{\TUnknown}{\ensuremath{\?}}
\newcommand{\TInt}{\ensuremath{\textsf{Num}}}
\newcommand{\TBool}{\ensuremath{\textsf{Bool}}}
\newcommand{\TArrow}[2]{\ensuremath{#1 \to #2}}
\newcommand{\TPair}[2]{\ensuremath{#1 \times #2}}

%
% external expressions
%
\newcommand{\EMName}{\textsf{UExp}}
\newcommand{\EMSet}{\ensuremath{E}}
\newcommand{\EMV}{\ensuremath{e}}

% holes
\newcommand{\EEHole}{\ensuremath{\ECEHole}}

% integers
\newcommand{\EInt}[1]{\ensuremath{\ECInt{#1}}}
\newcommand{\EIntMV}{\ensuremath{\ECIntMV}}
\newcommand{\EOpPlus}{\ensuremath{\ECOpPlus}}
\newcommand{\EPlus}[2]{\ensuremath{\ECPlus{#1}{#2}}}

% booleans
\newcommand{\ETrue}{\ensuremath{\ECTrue}}
\newcommand{\EFalse}{\ensuremath{\ECFalse}}
\newcommand{\EIf}[3]{\ensuremath{\ECIf{#1}{#2}{#3}}}

% lambdas
\newcommand{\ELam}[3]{\ensuremath{\ECLam{#1}{#2}{#3}}}
\newcommand{\EAp}[2]{\ensuremath{\ECAp{#1}{#2}}}

% pairs
\newcommand{\EPair}[2]{\ensuremath{\ECPair{#1}{#2}}}
\newcommand{\EProjL}[1]{\ensuremath{\ECProjL{#1}}}
\newcommand{\EProjR}[1]{\ensuremath{\ECProjR{#1}}}

%
% cursor types
%
\newcommand{\ZTMName}{\textsf{ZType}}
\newcommand{\ZTMSet}{\ensuremath{\hat{T}}}
\newcommand{\ZTMV}{\ensuremath{\hat{\tau}}}

% cursor
\newcommand{\ZTCursor}[1]{\ensuremath{\ZCursor{#1}}}

% arrow
\newcommand{\ZTArrowL}[2]{\ensuremath{\TArrow{#1}{#2}}}
\newcommand{\ZTArrowR}[2]{\ensuremath{\TArrow{#1}{#2}}}

%
% cursor expressions
%
\newcommand{\ZMName}{\textsf{ZExp}}
\newcommand{\ZMSet}{\ensuremath{\hat{E}}}
\newcommand{\ZMV}{\ensuremath{\hat{e}}}

% cursor
\newcommand{\ZCursor}[1]{\ensuremath{\mathcolorbox{cursorhighlight}{\textcolor{cursor}{\bm{\triangleright}}#1\textcolor{cursor}{\bm{\triangleleft}}}}}

% integers
\newcommand{\ZPlusL}[2]{\ensuremath{\ECPlus{#1}{#2}}}
\newcommand{\ZPlusR}[2]{\ensuremath{\ECPlus{#1}{#2}}}

% lambdas
\newcommand{\ZLamT}[3]{\ensuremath{\ECLam{#1}{#2}{#3}}}
\newcommand{\ZLamE}[3]{\ensuremath{\ECLam{#1}{#2}{#3}}}
\newcommand{\ZApL}[2]{\ensuremath{\ECAp{#1}{#2}}}
\newcommand{\ZApR}[2]{\ensuremath{\ECAp{#1}{#2}}}

% booleans
\newcommand{\ZIfC}[3]{\ensuremath{\ECIf{#1}{#2}{#3}}}
\newcommand{\ZIfL}[3]{\ensuremath{\ECIf{#1}{#2}{#3}}}
\newcommand{\ZIfR}[3]{\ensuremath{\ECIf{#1}{#2}{#3}}}

%
% marked expressions
%
\newcommand{\ECMName}{\textsf{MExp}}
\newcommand{\ECMSet}{\ensuremath{\check{E}}}
\newcommand{\ECMV}{\ensuremath{\check{e}}}

% holes
\newcommand{\ECEHole}{\ensuremath{\textcolor{hole}{\bm{\llparenthesis}}\textcolor{hole}{\bm{\rrparenthesis}}}}

% integers
\newcommand{\ECInt}[1]{\ensuremath{\underline{#1}}}
\newcommand{\ECIntMV}{\ensuremath{\ECInt{n}}}
\newcommand{\ECOpPlus}{\ensuremath{+}}
\newcommand{\ECPlus}[2]{\ensuremath{#1 \ECOpPlus #2}}

% booleans
\newcommand{\ECTrue}{\ensuremath{\textsf{tt}}}
\newcommand{\ECFalse}{\ensuremath{\textsf{ff}}}
\newcommand{\ECIf}[3]{\ensuremath{#1 ~?~ #2 : #3}}

% lambdas
\newcommand{\ECLam}[3]{\ensuremath{\lambda #1 : #2. ~#3}}
\newcommand{\ECAp}[2]{\ensuremath{#1 ~#2}}
\newcommand{\ECNonMatchedAp}[2]{\ensuremath{\textcolor{red}{[}\ECAp{#1}{#2}\textcolor{red}{]}}}

% pairs
\newcommand{\ECPair}[2]{\ensuremath{(#1, #2)}}
\newcommand{\ECProjL}[1]{\ensuremath{#1.0}}
\newcommand{\ECProjR}[1]{\ensuremath{#1.1}}

% errors
\newcommand{\MRMName}{\textsf{MReason}}
\newcommand{\MRMV}{\ensuremath{r}}
\newcommand{\MRUnbound}{\ensuremath{\mathsmaller{\mathsmaller{\mathsmaller{\square}}}}}
\newcommand{\MRInconType}{\ensuremath{\mathsmaller{\inconsistentRel}}}
\newcommand{\MRInconBr}{\ensuremath{\mathlarger{\noJoinRel}}}

\newcommand{\ECMarked}[2]{\ensuremath{\textcolor{red}{\bm{\llparenthesis}}#1\textcolor{red}{\bm{\rrparenthesis}_{#2}}}}
\newcommand{\ECMarkedUnbound}[1]{\ensuremath{\ECMarked{#1}{\MRUnbound}}}
\newcommand{\ECMarkedInconType}[1]{\ensuremath{\ECMarked{#1}{\MRInconType}}}
\newcommand{\ECMarkedInconBr}[1]{\ensuremath{\ECMarked{#1}{\MRInconBr}}}

\newcommand{\ECUnbound}[1]{\ensuremath{\ECMarkedUnbound{#1}}}
\newcommand{\ECInconType}[1]{\ensuremath{\ECMarkedInconType{#1}}}
\newcommand{\ECInconBr}[3]{\ensuremath{\ECMarkedInconBr{\ECIf{#1}{#2}{#3}}}}

\newcommand{\ECInconMatched}[2]{\ensuremath{\ECMarked{#1}{#2}}}
\newcommand{\ECInconMatchedArrow}[1]{\ensuremath{\ECInconMatched{#1}{\notMatchedArrowRel}}}
\newcommand{\ECInconMatchedPair}[1]{\ensuremath{\ECInconMatched{#1}{\notMatchedPairRel}}}

%
% actions
%
\newcommand{\AMName}{\textsf{Action}}
\newcommand{\AMV}{\ensuremath{\alpha}}

\newcommand{\AAction}[3]{\ensuremath{#1 \xrightarrow{#3} #2}}

% movement
\newcommand{\AMChild}[3]{\ensuremath{\AAction{#1}{#2}{\textsf{move child #3}}}}
\newcommand{\AMParent}[2]{\ensuremath{\AAction{#1}{#2}{\textsf{move parent}}}}

% deletion
\newcommand{\ADel}[2]{\ensuremath{\AAction{#1}{#2}{\textsf{del}}}}

% construction
\newcommand{\ACon}[3]{\ensuremath{\AAction{#1}{#2}{\textsf{construct #3}}}}

%
% type actions
%
\newcommand{\ATAction}[3]{\ensuremath{\AAction{#1}{#2}{#3}}}

% movement
\newcommand{\ATMChild}[3]{\ensuremath{\AMChild{\ZTCursor{#1}}{#2}{#3}}}
\newcommand{\ATMParent}[2]{\ensuremath{\AMParent{#1}{\ZTCursor{#2}}}}
\newcommand{\ATMArrowChildL}[2]{\ensuremath{\ATMChild{\TArrow{#1}{#2}}{\ZTArrowL{\ZCursor{#1}}{#2}}{1}}}
\newcommand{\ATMArrowChildR}[2]{\ensuremath{\ATMChild{\TArrow{#1}{#2}}{\ZTArrowR{#2}{\ZCursor{#1}}}{2}}}
\newcommand{\ATMArrowParentL}[2]{\ensuremath{\ATMParent{\ZTArrowL{\ZCursor{#1}}{#2}}{\TArrow{#1}{#2}}}}
\newcommand{\ATMArrowParentR}[2]{\ensuremath{\ATMParent{\ZTArrowR{#2}{\ZCursor{#1}}}{\TArrow{#1}{#2}}}}

% deletion
\newcommand{\ATDel}[2]{\ensuremath{\ADel{\ZCursor{#1}}{\ZCursor{#2}}}}

% construction
\newcommand{\ATConArrow}[1]{\ensuremath{\ACon{\ZTCursor{#1}}{(\ZTArrowR{#1}{\ZTCursor{\TUnknown}})}{arrow}}}
\newcommand{\ATConInt}{\ensuremath{\ACon{\ZTCursor{\TUnknown}}{\ZTCursor{\TInt}}{num}}}
\newcommand{\ATConBool}{\ensuremath{\ACon{\ZTCursor{\TUnknown}}{\ZTCursor{\TBool}}{bool}}}
