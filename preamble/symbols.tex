%
% utilities
%
\definecolor{hole}{RGB}{162,85,162}
\definecolor{cursorhighlight}{RGB}{230,255,230}
\definecolor{cursor}{RGB}{76,170,76}
\newcommand{\mathcolorbox}[2]{{\fboxsep=1pt\colorbox{#1}{$\displaystyle #2$}}}

%
% judgments
%

% judgments
\newcommand{\judgment}[3]{\inferrule{#1}{#2}~~{\textsc{\small [#3]}}}
\newcommand{\judgbox}[1]{\noindent \fbox{$#1$}}

% consistency
\newcommand{\consistent}[2]{\ensuremath{#1 \sim #2}}
\newcommand{\inconsistentRel}{\ensuremath{\nsim}}
\newcommand{\inconsistent}[2]{\ensuremath{#1 \inconsistentRel #2}}

% matching
\newcommand{\matchedRel}[1]{\ensuremath{\blacktriangleright_{#1}}}
\newcommand{\notMatchedRel}[1]{\ensuremath{\blacktriangleright_{\centernot#1}}}
\newcommand{\matchedArrowRel}{\ensuremath{\matchedRel{\to}}}
\newcommand{\notMatchedArrowRel}{\ensuremath{\notMatchedRel{\to}}}
\newcommand{\matchedArrow}[3]{\ensuremath{#1 \matchedArrowRel \TArrow{#2}{#3}}}
\newcommand{\notMatchedArrow}[3]{\ensuremath{#1 \notMatchedArrowRel \TArrow{#2}{#3}}}
\newcommand{\matchedPairRel}{\ensuremath{\matchedRel{\times}}}
\newcommand{\notMatchedPairRel}{\ensuremath{\notMatchedRel{\times}}}
\newcommand{\matchedPair}[3]{\ensuremath{#1 \matchedPairRel \TPair{#2}{#3}}}
\newcommand{\notMatchedPair}[3]{\ensuremath{#1 \notMatchedPairRel \TPair{#2}{#3}}}

% contexts
\newcommand{\ctx}{\ensuremath{\Gamma}}
\newcommand{\extendCtx}[3]{\ensuremath{#1 ; ~\assignType{#2}{#3}}}
\DeclareMathOperator{\dom}{dom}
\newcommand{\inCtx}[3]{\ensuremath{#2, #3 \in #1}}
\newcommand{\notInCtx}[2]{\ensuremath{#2 \not\in \dom(#1)}}
\newcommand{\withCtx}[2]{\ensuremath{#1 \vdash #2}}

% typing
\newcommand{\assignType}[2]{\ensuremath{#1 : #2}}
\newcommand{\ctxAssignType}[3]{\ensuremath{\withCtx{#1}{\assignType{#2}{#3}}}}
\newcommand{\synType}[2]{\ensuremath{#1 \Rightarrow #2}}
\newcommand{\ctxSynType}[3]{\ensuremath{\withCtx{#1}{\synType{#2}{#3}}}}
\newcommand{\anaType}[2]{\ensuremath{#1 \Leftarrow #2}}
\newcommand{\ctxAnaType}[3]{\ensuremath{\withCtx{#1}{\anaType{#2}{#3}}}}

% subsumable
\newcommand{\subsumable}[1]{\ensuremath{#1 ~{\normalfont{\normalfont\textsf{subsumable}}}}}

% mark erasure
\newcommand{\erase}[1]{\ensuremath{#1^{\square}}}
\newcommand{\erasesTo}[2]{\ensuremath{#1^{\square} = #2}}

% marking
\newcommand{\synFixedInto}[3]{\ensuremath{\synType{#1 \looparrowright #2}{#3}}}
\newcommand{\ctxSynFixedInto}[4]{\ensuremath{\withCtx{#1}{\synFixedInto{#2}{#3}{#4}}}}
\newcommand{\anaFixedInto}[3]{\ensuremath{\anaType{#1 \looparrowright #2}{#3}}}
\newcommand{\ctxAnaFixedInto}[4]{\ensuremath{\withCtx{#1}{\anaFixedInto{#2}{#3}{#4}}}}

% marking image
\newcommand{\image}[1]{\ensuremath{#1^{\circ}}}
\newcommand{\imageIs}[2]{\ensuremath{\image{#1} = #2}}
\newcommand{\imageIsNot}[2]{\ensuremath{\image{#1} \neq #2}}

% cursor erasure
\newcommand{\cursorErase}[1]{\ensuremath{#1^{\diamond}}}
\newcommand{\cursorErasesTo}[2]{\ensuremath{#1^{\diamond} = #2}}

% 
% types
%
\newcommand{\TMName}{{\normalfont\textsf{Type}}}
\newcommand{\TMSet}{\ensuremath{T}}
\newcommand{\TMV}{\ensuremath{\tau}}

\newcommand{\joinRel}{\sqcup}
\newcommand{\noJoinRel}{\centernot\sqcup}
\newcommand{\TJoin}[2]{\ensuremath{#1 \joinRel #2}}

\DeclareMathOperator{\?}{?}
\newcommand{\TUnknown}{\ensuremath{\?}}
\newcommand{\TNum}{\ensuremath{{\normalfont\textsf{Num}}}}
\newcommand{\TBool}{\ensuremath{{\normalfont\textsf{Bool}}}}
\newcommand{\TArrow}[2]{\ensuremath{#1 \to #2}}
\newcommand{\TPair}[2]{\ensuremath{#1 \times #2}}

%
% external expressions
%
\newcommand{\EMName}{{\normalfont\textsf{UExp}}}
\newcommand{\EMSet}{\ensuremath{E}}
\newcommand{\EMV}{\ensuremath{e}}

% holes
\newcommand{\EEHole}{\ensuremath{\ECEHole}}

% integers
\newcommand{\ENum}[1]{\ensuremath{\ECNum{#1}}}
\newcommand{\ENumMV}{\ensuremath{\ECNumMV}}
\newcommand{\EOpPlus}{\ensuremath{\ECOpPlus}}
\newcommand{\EPlus}[2]{\ensuremath{\ECPlus{#1}{#2}}}

% booleans
\newcommand{\ETrue}{\ensuremath{\ECTrue}}
\newcommand{\EFalse}{\ensuremath{\ECFalse}}
\newcommand{\EIf}[3]{\ensuremath{\ECIf{#1}{#2}{#3}}}

% lambdas
\newcommand{\ELam}[3]{\ensuremath{\ECLam{#1}{#2}{#3}}}
\newcommand{\EAp}[2]{\ensuremath{\ECAp{#1}{#2}}}

% pairs
\newcommand{\EPair}[2]{\ensuremath{\ECPair{#1}{#2}}}
\newcommand{\EProjL}[1]{\ensuremath{\ECProjL{#1}}}
\newcommand{\EProjR}[1]{\ensuremath{\ECProjR{#1}}}

% let
\newcommand{\ELet}[3]{\ensuremath{\ECLet{#1}{#2}{#3}}}

%
% cursor types
%
\newcommand{\ZTMName}{{\normalfont\textsf{ZType}}}
\newcommand{\ZTMSet}{\ensuremath{\hat{T}}}
\newcommand{\ZTMV}{\ensuremath{\hat{\tau}}}

% cursor
\newcommand{\ZTCursor}[1]{\ensuremath{\ZCursor{#1}}}

% arrow
\newcommand{\ZTArrowL}[2]{\ensuremath{\TArrow{#1}{#2}}}
\newcommand{\ZTArrowR}[2]{\ensuremath{\TArrow{#1}{#2}}}

%
% cursor expressions
%
\newcommand{\ZMName}{{\normalfont\textsf{ZExp}}}
\newcommand{\ZMSet}{\ensuremath{\hat{E}}}
\newcommand{\ZMV}{\ensuremath{\hat{e}}}

% cursor
\newcommand{\ZCursor}[1]{\ensuremath{\mathcolorbox{cursorhighlight}{\textcolor{cursor}{\bm{\triangleright}}#1\textcolor{cursor}{\bm{\triangleleft}}}}}

% integers
\newcommand{\ZPlusL}[2]{\ensuremath{\ECPlus{#1}{#2}}}
\newcommand{\ZPlusR}[2]{\ensuremath{\ECPlus{#1}{#2}}}

% lambdas
\newcommand{\ZLamT}[3]{\ensuremath{\ECLam{#1}{#2}{#3}}}
\newcommand{\ZLamE}[3]{\ensuremath{\ECLam{#1}{#2}{#3}}}
\newcommand{\ZApL}[2]{\ensuremath{\ECAp{#1}{#2}}}
\newcommand{\ZApR}[2]{\ensuremath{\ECAp{#1}{#2}}}

% booleans
\newcommand{\ZIfC}[3]{\ensuremath{\ECIf{#1}{#2}{#3}}}
\newcommand{\ZIfL}[3]{\ensuremath{\ECIf{#1}{#2}{#3}}}
\newcommand{\ZIfR}[3]{\ensuremath{\ECIf{#1}{#2}{#3}}}

% let
\newcommand{\ZLet}[3]{\ensuremath{\ECLet{#1}{#2}{#3}}}

%
% marked expressions
%
\newcommand{\ECMName}{{\normalfont\textsf{MExp}}}
\newcommand{\ECMSet}{\ensuremath{\check{E}}}
\newcommand{\ECMV}{\ensuremath{\check{e}}}

% holes
\newcommand{\ECEHole}{\ensuremath{\textcolor{hole}{\bm{\llparenthesis}}\textcolor{hole}{\bm{\rrparenthesis}}}}

% integers
\newcommand{\ECNum}[1]{\ensuremath{\underline{#1}}}
\newcommand{\ECNumMV}{\ensuremath{\ECNum{n}}}
\newcommand{\ECOpPlus}{\ensuremath{+}}
\newcommand{\ECPlus}[2]{\ensuremath{#1 \ECOpPlus #2}}

% booleans
\newcommand{\ECTrue}{\ensuremath{{\normalfont\textsf{tt}}}}
\newcommand{\ECFalse}{\ensuremath{{\normalfont\textsf{ff}}}}
\newcommand{\ECIf}[3]{\ensuremath{#1 ~?~ #2 : #3}}

% lambdas
\newcommand{\ECLam}[3]{\ensuremath{\lambda #1 : #2. ~#3}}
\newcommand{\ECAp}[2]{\ensuremath{#1 ~#2}}
\newcommand{\ECNonMatchedAp}[2]{\ensuremath{\textcolor{red}{[}\ECAp{#1}{#2}\textcolor{red}{]}}}

% pairs
\newcommand{\ECPair}[2]{\ensuremath{(#1, #2)}}
\newcommand{\ECProjL}[1]{\ensuremath{#1.0}}
\newcommand{\ECProjR}[1]{\ensuremath{#1.1}}

% let
\newcommand{\ECLet}[3]{\ensuremath{\textsf{let}~ #1 = #2 ~\textsf{in}~ #3}}

% errors
\newcommand{\MRMName}{{\normalfont\textsf{MReason}}}
\newcommand{\MRMV}{\ensuremath{r}}
\newcommand{\MRUnbound}{\ensuremath{\mathsmaller{\mathsmaller{\mathsmaller{\square}}}}}
\newcommand{\MRInconType}{\ensuremath{\mathsmaller{\inconsistentRel}}}
\newcommand{\MRInconBr}{\ensuremath{\mathlarger{\noJoinRel}}}

\newcommand{\ECMarked}[2]{\ensuremath{\textcolor{red}{\bm{\llparenthesis}}#1\textcolor{red}{\bm{\rrparenthesis}_{#2}}}}
\newcommand{\ECMarkedUnbound}[1]{\ensuremath{\ECMarked{#1}{\MRUnbound}}}
\newcommand{\ECMarkedInconType}[1]{\ensuremath{\ECMarked{#1}{\MRInconType}}}
\newcommand{\ECMarkedInconBr}[1]{\ensuremath{\ECMarked{#1}{\MRInconBr}}}

\newcommand{\ECUnbound}[1]{\ensuremath{\ECMarkedUnbound{#1}}}
\newcommand{\ECInconType}[1]{\ensuremath{\ECMarkedInconType{#1}}}
\newcommand{\ECInconBr}[3]{\ensuremath{\ECMarkedInconBr{\ECIf{#1}{#2}{#3}}}}

\newcommand{\ECInconMatched}[2]{\ensuremath{\ECMarked{#1}{#2}}}
\newcommand{\ECInconMatchedArrow}[1]{\ensuremath{\ECInconMatched{#1}{\notMatchedArrowRel}}}
\newcommand{\ECInconMatchedPair}[1]{\ensuremath{\ECInconMatched{#1}{\notMatchedPairRel}}}

%
% actions
%

% actions
\newcommand{\AMName}{{\normalfont\textsf{Action}}}
\newcommand{\AMV}{\ensuremath{\alpha}}
\newcommand{\AMove}[1]{\ensuremath{{\normalfont\textsf{move $#1$}}}}
\newcommand{\ADel}{\ensuremath{{\normalfont\textsf{del}}}}
\newcommand{\ACon}[1]{\ensuremath{{\normalfont\textsf{construct $#1$}}}}

% iterated actions
\newcommand{\AIMName}{{\normalfont\textsf{ActionList}}}
\newcommand{\AIMV}{\ensuremath{\overline{\alpha}}}
\newcommand{\AINil}{\ensuremath{\cdot}}
\newcommand{\AICons}[2]{\ensuremath{#1; #2}}

% directions
\newcommand{\MMName}{{\normalfont\textsf{Dir}}}
\newcommand{\MMV}{\ensuremath{\delta}}
\newcommand{\MChild}[1]{\ensuremath{{\normalfont\textsf{child $#1$}}}}
\newcommand{\MChildNMV}{\ensuremath{n}}
\newcommand{\MParent}{\ensuremath{{\normalfont\textsf{parent}}}}

% shapes
\newcommand{\SMName}{{\normalfont\textsf{Shape}}}
\newcommand{\SMV}{\ensuremath{\psi}}

\newcommand{\STArrow}{\ensuremath{{\normalfont\textsf{arrow}}}}
\newcommand{\STNum}{\ensuremath{{\normalfont\textsf{num}}}}
\newcommand{\STBool}{\ensuremath{{\normalfont\textsf{bool}}}}

\newcommand{\SVar}[1]{\ensuremath{{\normalfont\textsf{var $#1$}}}}
\newcommand{\SLam}[1]{\ensuremath{{\normalfont\textsf{lam $#1$}}}}
\newcommand{\SApL}{\ensuremath{{\normalfont\textsf{ap\textsubscript{L}}}}}
\newcommand{\SApR}{\ensuremath{{\normalfont\textsf{ap\textsubscript{R}}}}}
\newcommand{\SNumLit}[1]{\ensuremath{{\normalfont\textsf{lit $#1$}}}}
\newcommand{\SPlusL}{\ensuremath{{\normalfont\textsf{plus\textsubscript{L}}}}}
\newcommand{\SPlusR}{\ensuremath{{\normalfont\textsf{plus\textsubscript{R}}}}}
\newcommand{\STrue}{\ensuremath{{\normalfont\textsf{true}}}}
\newcommand{\SFalse}{\ensuremath{{\normalfont\textsf{false}}}}
\newcommand{\SIfC}{\ensuremath{{\normalfont\textsf{if\textsubscript{C}}}}}
\newcommand{\SIfL}{\ensuremath{{\normalfont\textsf{if\textsubscript{L}}}}}
\newcommand{\SIfR}{\ensuremath{{\normalfont\textsf{if\textsubscript{R}}}}}

%
% action judgments
%
\newcommand{\AAction}[3]{\ensuremath{#1 \xrightarrow{#3} #2}}
\newcommand{\AActionIter}[3]{\ensuremath{#1 \xrightarrow{#3}* #2}}
\newcommand{\movements}[1]{\ensuremath{#1 ~{\normalfont{\normalfont\textsf{movements}}}}}

% movement
\newcommand{\AMChild}[3]{\ensuremath{\AAction{#1}{#2}{\AMove{\MChild{#3}}}}}
\newcommand{\AMParent}[2]{\ensuremath{\AAction{#1}{#2}{\AMove{\MParent}}}}

% deletion
\newcommand{\ADDel}[2]{\ensuremath{\AAction{#1}{#2}{\ADel}}}

% construction
\newcommand{\ACCon}[3]{\ensuremath{\AAction{#1}{#2}{\ACon{#3}}}}

%
% type actions
%
\newcommand{\ATAction}[3]{\ensuremath{\AAction{#1}{#2}{#3}}}
\newcommand{\ATActionIter}[3]{\ensuremath{\AActionIter{#1}{#2}{#3}}}

% movement
\newcommand{\ATMChild}[3]{\ensuremath{\AMChild{\ZTCursor{#1}}{#2}{#3}}}
\newcommand{\ATMParent}[2]{\ensuremath{\AMParent{#1}{\ZTCursor{#2}}}}
\newcommand{\ATMArrowChildL}[2]{\ensuremath{\ATMChild{\TArrow{#1}{#2}}{\ZTArrowL{\ZTCursor{#1}}{#2}}{1}}}
\newcommand{\ATMArrowChildR}[2]{\ensuremath{\ATMChild{\TArrow{#1}{#2}}{\ZTArrowR{#2}{\ZTCursor{#1}}}{2}}}
\newcommand{\ATMArrowParentL}[2]{\ensuremath{\ATMParent{\ZTArrowL{\ZTCursor{#1}}{#2}}{\TArrow{#1}{#2}}}}
\newcommand{\ATMArrowParentR}[2]{\ensuremath{\ATMParent{\ZTArrowR{#2}{\ZTCursor{#1}}}{\TArrow{#1}{#2}}}}

% deletion
\newcommand{\ATDel}[1]{\ensuremath{\ADDel{\ZTCursor{#1}}{\ZTCursor{\TUnknown}}}}

% construction
\newcommand{\ATConArrow}[1]{\ensuremath{\ACCon{\ZTCursor{#1}}{(\ZTArrowR{#1}{\ZTCursor{\TUnknown}})}{\STArrow}}}
\newcommand{\ATConNum}{\ensuremath{\ACCon{\ZTCursor{\TUnknown}}{\ZTCursor{\TNum}}{\STNum}}}
\newcommand{\ATConBool}{\ensuremath{\ACCon{\ZTCursor{\TUnknown}}{\ZTCursor{\TBool}}{\STBool}}}

%
% expression actions
%
\newcommand{\AEAction}[3]{\ensuremath{\AAction{#1}{#2}{#3}}}
\newcommand{\AEActionIter}[3]{\ensuremath{\AActionIter{#1}{#2}{#3}}}

% movement
\newcommand{\AEMAction}[3]{\ensuremath{\AEAction{#1}{#2}{{\normalfont\textsf{move $#3$}}}}}
\newcommand{\AEMChild}[3]{\ensuremath{\AMChild{\ZCursor{#1}}{#2}{#3}}}
\newcommand{\AEMParent}[2]{\ensuremath{\AMParent{#1}{\ZCursor{#2}}}}

\newcommand{\AEMLamChildT}[3]{\ensuremath{\AEMChild{\ELam{#1}{#2}{#3}}{\ZLamT{#1}{\ZTCursor{#2}}{#3}}{1}}}
\newcommand{\AEMLamChildE}[3]{\ensuremath{\AEMChild{\ELam{#1}{#2}{#3}}{\ZLamE{#1}{#2}{\ZCursor{#3}}}{2}}}
\newcommand{\AEMLamParentT}[3]{\ensuremath{\AEMParent{\ZLamT{#1}{\ZTCursor{#2}}{#3}}{\ELam{#1}{#2}{#3}}}}
\newcommand{\AEMLamParentE}[3]{\ensuremath{\AEMParent{\ZLamE{#1}{#2}{\ZCursor{#3}}}{\ELam{#1}{#2}{#3}}}}
\newcommand{\AEMApChildL}[2]{\ensuremath{\AEMChild{\EAp{#1}{#2}}{\ZApL{\ZCursor{#1}}{#2}}{1}}}
\newcommand{\AEMApChildR}[2]{\ensuremath{\AEMChild{\EAp{#1}{#2}}{\ZApR{#1}{\ZCursor{#2}}}{2}}}
\newcommand{\AEMApParentL}[2]{\ensuremath{\AEMParent{\ZApL{\ZCursor{#1}}{#2}}{\EAp{#1}{#2}}}}
\newcommand{\AEMApParentR}[2]{\ensuremath{\AEMParent{\ZApR{#1}{\ZCursor{#2}}}{\EAp{#1}{#2}}}}
\newcommand{\AEMPlusChildL}[2]{\ensuremath{\AEMChild{\EPlus{#1}{#2}}{\ZPlusL{\ZCursor{#1}}{#2}}{1}}}
\newcommand{\AEMPlusChildR}[2]{\ensuremath{\AEMChild{\EPlus{#1}{#2}}{\ZPlusR{#1}{\ZCursor{#2}}}{2}}}
\newcommand{\AEMPlusParentL}[2]{\ensuremath{\AEMParent{\ZPlusL{\ZCursor{#1}}{#2}}{\EPlus{#1}{#2}}}}
\newcommand{\AEMPlusParentR}[2]{\ensuremath{\AEMParent{\ZPlusR{#1}{\ZCursor{#2}}}{\EPlus{#1}{#2}}}}
\newcommand{\AEMIfChildC}[3]{\ensuremath{\AEMChild{\EIf{#1}{#2}{#3}}{\ZIfC{\ZCursor{#1}}{#2}{#3}}{1}}}
\newcommand{\AEMIfChildL}[3]{\ensuremath{\AEMChild{\EIf{#1}{#2}{#3}}{\ZIfL{#1}{\ZCursor{#2}}{#3}}{2}}}
\newcommand{\AEMIfChildR}[3]{\ensuremath{\AEMChild{\EIf{#1}{#2}{#3}}{\ZIfR{#1}{#2}{\ZCursor{#3}}}{3}}}
\newcommand{\AEMIfParentC}[3]{\ensuremath{\AEMParent{\ZIfC{\ZCursor{#1}}{#2}{#3}}{\EIf{#1}{#2}{#3}}}}
\newcommand{\AEMIfParentL}[3]{\ensuremath{\AEMParent{\ZIfL{#1}{\ZCursor{#2}}{#3}}{\EIf{#1}{#2}{#3}}}}
\newcommand{\AEMIfParentR}[3]{\ensuremath{\AEMParent{\ZIfR{#1}{#2}{\ZCursor{#3}}}{\EIf{#1}{#2}{#3}}}}

% deletion
\newcommand{\AEDel}[1]{\ensuremath{\ADDel{\ZCursor{#1}}{\ZCursor{\EEHole}}}}

% construction
\newcommand{\AEConVar}[1]{\ensuremath{\ACCon{\ZCursor{\EEHole}}{\ZCursor{#1}}{\SVar{#1}}}}
\newcommand{\AEConLam}[2]{\ensuremath{\ACCon{\ZCursor{#2}}{\ZLamT{#1}{\ZTCursor{\TUnknown}}{#2}}{\SLam{#1}}}}
\newcommand{\AEConApL}[1]{\ensuremath{\ACCon{\ZCursor{#1}}{\ZApR{#1}{\ZCursor{\EEHole}}}{\SApL}}}
\newcommand{\AEConApR}[1]{\ensuremath{\ACCon{\ZCursor{#1}}{\ZApR{\ZCursor{\EEHole}}{#1}}{\SApR}}}
\newcommand{\AEConNum}[1]{\ensuremath{\ACCon{\ZCursor{\EEHole}}{\ZCursor{#1}}{\SNumLit{#1}}}}
\newcommand{\AEConPlusL}[1]{\ensuremath{\ACCon{\ZCursor{#1}}{\ZPlusR{#1}{\ZCursor{\EEHole}}}{\SPlusL}}}
\newcommand{\AEConPlusR}[1]{\ensuremath{\ACCon{\ZCursor{#1}}{\ZPlusR{\ZCursor{\EEHole}}{#1}}{\SPlusR}}}
\newcommand{\AEConTrue}{\ensuremath{\ACCon{\ZCursor{\EEHole}}{\ZCursor{\ETrue}}{\STrue}}}
\newcommand{\AEConFalse}{\ensuremath{\ACCon{\ZCursor{\EEHole}}{\ZCursor{\EFalse}}{\SFalse}}}
\newcommand{\AEConIfC}[1]{\ensuremath{\ACCon{\ZCursor{#1}}{\ZIfC{#1}{\ZCursor{\EEHole}}{\EEHole}}{\SIfC}}}
\newcommand{\AEConIfL}[1]{\ensuremath{\ACCon{\ZCursor{#1}}{\ZIfC{\ZCursor{\EEHole}}{#1}{\EEHole}}{\SIfC}}}
\newcommand{\AEConIfR}[1]{\ensuremath{\ACCon{\ZCursor{#1}}{\ZIfC{\ZCursor{\EEHole}}{\EEHole}{#1}}{\SIfC}}}
